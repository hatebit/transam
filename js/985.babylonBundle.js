(self.webpackChunktrans_america=self.webpackChunktrans_america||[]).push([[985,938,556,738,11],{7938:(e,t,s)=>{"use strict";s.r(t),s.d(t,{Boxes:()=>c});var i=s(517),a=s(9529),h=s(2404),r=s(5714),n=s(3077);const o=s.p+"03713868bab7dd2e96995060bf2ae0f5.png";class c{constructor(e){this.scene=e,this.blueMaterial=new i.F("BlueMaterial",e),this.blueMaterial.diffuseColor=new a.v9(.5,.4,.8),this.blueMaterial.emissiveColor=new a.v9(.5,.4,.8),this.concreteMaterial=new i.F("concrete material",e),this.concreteMaterial.diffuseTexture=new n.g(o,e)}baseBoxes(){this.createBox(new a.Pq(4,1,12),new a.Pq(0,0,25),new a.Pq(-Math.PI/8,0,0),0),this.createBox(new a.Pq(4,1,12),new a.Pq(25,0,0),new a.Pq(-Math.PI/8,Math.PI/2,0),0),this.createBox(new a.Pq(4,1,12),new a.Pq(0,0,-25),new a.Pq(Math.PI/8,0,0),0),this.createBox(new a.Pq(4,1,12),new a.Pq(-25,0,0),new a.Pq(Math.PI/8,Math.PI/2,0),0)}randomBoxes(){const e=new a.Pq,t=new a.Pq,s=new a.Pq;for(let i=0;i<20;i++){const i=300*Math.random()-150+5,a=300*Math.random()-150+5,h=10*Math.random();e.set(h,h,h),t.set(a,0,i),s.set(i,i,i),this.createBox(e,t,s,0)}for(let i=0;i<30;i++){const i=300*Math.random()-150+5,a=300*Math.random()-150+5,h=3*Math.random();e.set(h,h,h),t.set(a,0,i),s.set(i,i,i),this.createBox(e,t,s,5)}}createBox(e,t,s,i){const a=h.P.CreateBox("box",{width:e.x,depth:e.z,height:e.y},this.scene);return a.position.set(t.x,t.y,t.z),a.rotation.set(s.x,s.y,s.z),i?(a.position.y+=5,a.material=this.blueMaterial):(i=0,a.material=this.concreteMaterial),a.physicsImpostor=new r.j(a,r.j.BoxImpostor,{mass:i,friction:.5,restitution:.7},this.scene),a}cellBoxes(e,t){const s=e/2,i=new a.Pq,h=new a.Pq,r=new a.Pq;for(let a=0;a<20;a++){const a=Math.random()*e-s,n=Math.random()*e-s,o=10*Math.random();i.set(o,o,o),h.set(n,0,a),r.set(a,a,a),this.createBox(i,h,r,0).parent=t}}createCellBox(e,t,s,i){const a=h.P.CreateBox("box",{width:e.x,depth:e.z,height:e.y});return a.position.set(t.x,t.y,t.z),a.rotation.set(s.x,s.y,s.z),i?(a.position.y+=5,a.material=this.blueMaterial):(i=0,a.material=this.concreteMaterial),a.physicsImpostor=new r.j(a,r.j.BoxImpostor,{mass:i,friction:.5,restitution:.7},this.scene),a}}},7556:(e,t,s)=>{"use strict";s.r(t),s.d(t,{Car:()=>r});var i=s(3325),a=s(9529),h=s(2404);class r{constructor(e,t,s){this.ZERO_QUATERNION=new a.PT,this.FRONT_LEFT=0,this.FRONT_RIGHT=1,this.BACK_LEFT=2,this.BACK_RIGHT=3,this.chassisWidth=1.8,this.chassisHeight=.6,this.chassisLength=4,this.massVehicle=200,this.wheelAxisPositionBack=-1,this.wheelRadiusBack=.4,this.wheelWidthBack=.3,this.wheelHalfTrackBack=1,this.wheelAxisHeightBack=.4,this.wheelAxisFrontPosition=1,this.wheelHalfTrackFront=1,this.wheelAxisHeightFront=.4,this.wheelRadiusFront=.4,this.wheelWidthFront=.3,this.friction=5,this.suspension={stiffness:10,damping:.3,compression:4.4,restLength:.6},this.rollInfluence=0,this.steeringIncrement=.01,this.steeringClamp=.2,this.maxEngineForce=500,this.maxBreakingForce=10,this.incEngine=10,this.vehicleSteering=0,this.engineForce=0,this.breakingForce=0,this.wheelMeshes=[],this.vehicleReady=!1,this.greenMaterial=new i.FUi("GreenMaterial",t),this.greenMaterial.diffuseColor=new a.v9(.1,.8,.5),this.greenMaterial.emissiveColor=new a.v9(.1,.8,.5),this.blackMaterial=new i.FUi("BlackMaterial",t),this.blackMaterial.diffuseColor=new a.v9(.1,.1,.1),this.blackMaterial.emissiveColor=new a.v9(.1,.1,.1),this.scene=t;const h=t.getPhysicsEngine()?.getPhysicsPlugin().world;this.wheelDirectionCS0=new s.btVector3(0,-1,0),this.wheelAxleCS=new s.btVector3(-1,0,0);const r=new s.btBoxShape(new s.btVector3(.5*this.chassisWidth,.5*this.chassisHeight,.5*this.chassisLength)),n=new s.btTransform;n.setIdentity(),n.setOrigin(new s.btVector3(0,5,0)),n.setRotation(new s.btQuaternion(this.ZERO_QUATERNION.x,this.ZERO_QUATERNION.y,this.ZERO_QUATERNION.z,this.ZERO_QUATERNION.w));const o=new s.btDefaultMotionState(n),c=new s.btVector3(0,0,0);r.calculateLocalInertia(this.massVehicle,c),this.chassisMesh=this.createChassisMesh(this.chassisWidth,this.chassisHeight,this.chassisLength);const l=new s.btVector3(0,.4,0),d=new s.btTransform;d.setIdentity(),d.setOrigin(l);const w=new s.btCompoundShape;w.addChildShape(d,r);const g=new s.btRigidBody(new s.btRigidBodyConstructionInfo(this.massVehicle,o,w,c));g.setActivationState(4),h.addRigidBody(g),this.tuning=new s.btVehicleTuning;const u=new s.btDefaultVehicleRaycaster(h);this.vehicle=new s.btRaycastVehicle(this.tuning,g,u),this.vehicle.setCoordinateSystem(0,1,2),h.addAction(this.vehicle),this.vehicle.getChassisWorldTransform(),this.addWheel(!0,new s.btVector3(this.wheelHalfTrackFront,this.wheelAxisHeightFront,this.wheelAxisFrontPosition),this.wheelRadiusFront,this.wheelWidthFront,this.FRONT_LEFT),this.addWheel(!0,new s.btVector3(-this.wheelHalfTrackFront,this.wheelAxisHeightFront,this.wheelAxisFrontPosition),this.wheelRadiusFront,this.wheelWidthFront,this.FRONT_RIGHT),this.addWheel(!1,new s.btVector3(-this.wheelHalfTrackBack,this.wheelAxisHeightBack,this.wheelAxisPositionBack),this.wheelRadiusBack,this.wheelWidthBack,this.BACK_LEFT),this.addWheel(!1,new s.btVector3(this.wheelHalfTrackBack,this.wheelAxisHeightBack,this.wheelAxisPositionBack),this.wheelRadiusBack,this.wheelWidthBack,this.BACK_RIGHT),this.vehicleReady=!0,this.ammoModule=s,this.body=g}reset(){const e=new this.ammoModule.btVector3(0,5,0),t=new this.ammoModule.btTransform;t.setOrigin(e),t.setRotation(new this.ammoModule.btQuaternion(this.ZERO_QUATERNION.x,this.ZERO_QUATERNION.y,this.ZERO_QUATERNION.z,this.ZERO_QUATERNION.w)),this.body.setWorldTransform(t)}createChassisMesh(e,t,s){const i=h.P.CreateBox("box",{width:e,depth:s,height:t},this.scene);return i.rotationQuaternion=new a.PT,i.material=this.greenMaterial,i}addWheel(e,t,s,i,a){const h=this.vehicle.addWheel(t,this.wheelDirectionCS0,this.wheelAxleCS,this.suspension.restLength,s,this.tuning,e);h.set_m_suspensionStiffness(this.suspension.stiffness),h.set_m_wheelsDampingRelaxation(this.suspension.damping),h.set_m_wheelsDampingCompression(this.suspension.compression),h.set_m_maxSuspensionForce(6e5),h.set_m_frictionSlip(40),h.set_m_rollInfluence(this.rollInfluence),this.wheelMeshes[a]=this.createWheelMesh(s,i)}createWheelMesh(e,t){const s=h.P.CreateCylinder("Wheel",{diameter:1,height:.5,tessellation:6},this.scene);return s.rotationQuaternion=new a.PT,s.material=this.blackMaterial,s}}},1738:(e,t,s)=>{"use strict";s.r(t),s.d(t,{Controls:()=>r});var i=s(9529);const a=new Map([["acceleration",!1],["braking",!1],["right",!1],["left",!1],["reset",!1],["stop",!1]]),h=new Map([["KeyW","acceleration"],["KeyS","braking"],["KeyA","left"],["KeyD","right"],["KeyR","reset"],["Space","stop"]]);class r{constructor(e){this.car=e,window.addEventListener("keydown",this.keydown),window.addEventListener("keyup",this.keyup)}update(){if(this.car.vehicleReady){const e=this.car.vehicle.getCurrentSpeedKmHour();let t,s,h,r;this.car.breakingForce=0,this.car.engineForce=0,a.get("reset")&&(this.car.reset(),console.log("reset "+this.car.chassisMesh.position)),a.get("acceleration")?e<-1?this.car.breakingForce=this.car.maxBreakingForce:this.car.engineForce=this.car.maxEngineForce:a.get("braking")?e>1?this.car.breakingForce=this.car.maxBreakingForce:this.car.engineForce=-this.car.maxEngineForce:a.get("stop")&&(e>1?this.car.breakingForce=2*this.car.maxBreakingForce:e<-1&&(this.car.engineForce=2*this.car.maxEngineForce)),a.get("right")?this.car.vehicleSteering<this.car.steeringClamp&&(this.car.vehicleSteering+=this.car.steeringIncrement):a.get("left")?this.car.vehicleSteering>-this.car.steeringClamp&&(this.car.vehicleSteering-=this.car.steeringIncrement):this.car.vehicleSteering=0,this.car.vehicle.applyEngineForce(this.car.engineForce,this.car.FRONT_LEFT),this.car.vehicle.applyEngineForce(this.car.engineForce,this.car.FRONT_RIGHT),this.car.vehicle.setBrake(this.car.breakingForce/2,this.car.FRONT_LEFT),this.car.vehicle.setBrake(this.car.breakingForce/2,this.car.FRONT_RIGHT),this.car.vehicle.setBrake(this.car.breakingForce,this.car.BACK_LEFT),this.car.vehicle.setBrake(this.car.breakingForce,this.car.BACK_RIGHT),this.car.vehicle.setSteeringValue(this.car.vehicleSteering,this.car.FRONT_LEFT),this.car.vehicle.setSteeringValue(this.car.vehicleSteering,this.car.FRONT_RIGHT);const n=this.car.vehicle.getNumWheels();for(r=0;r<n;r++)this.car.vehicle.updateWheelTransform(r,!0),t=this.car.vehicle.getWheelTransformWS(r),s=t.getOrigin(),h=t.getRotation(),this.car.wheelMeshes[r].position.set(s.x(),s.y(),s.z()),this.car.wheelMeshes[r].rotationQuaternion?.set(h.x(),h.y(),h.z(),h.w()),this.car.wheelMeshes[r].rotate(i._0.Z,Math.PI/2);t=this.car.vehicle.getChassisWorldTransform(),s=t.getOrigin(),h=t.getRotation(),this.car.chassisMesh.position.set(s.x(),s.y(),s.z()),this.car.chassisMesh.rotationQuaternion?.set(h.x(),h.y(),h.z(),h.w()),this.car.chassisMesh.rotate(i._0.X,Math.PI)}}keyup(e){h.get(e.code)&&a.set(h.get(e.code)??"",!1)}keydown(e){h.get(e.code)&&a.set(h.get(e.code)??"",!0)}}},6993:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>p});var i=s(2971),a=s(4983),h=s(7069),r=s(5847),n=(s(1570),s(517),s(9846));let o;const c=new Promise((e=>{(new n).then((t=>{o=t,e(t)}))}));var l=s(7938),d=s(7556),w=s(1738),g=s(11),u=s(5709),m=s(8070);const p=new class{constructor(){this.preTasks=[c],this.createScene=async(e,t)=>{const s=new i.Z(e);new h.g("light",new a.Pq(0,1,0),s).intensity=.7,s.enablePhysics(new a.Pq(0,-10,0),new r.v(!0,o));const n=new d.Car(new a.Pq(0,4,-20),s,o),c=new u.p("FollowCam",new a.Pq(0,10,-10),s);c.radius=10,c.heightOffset=4,c.rotationOffset=0,c.cameraAcceleration=.05,c.maxCameraSpeed=400,c.attachControl(!0),c.lockedTarget=n.chassisMesh,s.activeCamera=c;const p=new g.WorldMap(s),M=(new l.Boxes(s),new w.Controls(n));let f=-9999,x=-9999;return s.registerBeforeRender((function(){e.getDeltaTime(),M.update();const t=n.chassisMesh.position,s=0|Math.round(t.x/g.DEFAULT_CELL_SIZE),i=0|Math.round(t.z/g.DEFAULT_CELL_SIZE);f===s&&x===i||(console.log(s,i),f=s,x=i),p.update(s,i),m.L_.innerHTML=e.getFps().toFixed()+" fps",m.Xz.innerHTML=s+","+i,m.Hq.innerHTML=n.vehicle.getCurrentSpeedKmHour().toFixed()+" km/h"})),s}}}},11:(e,t,s)=>{"use strict";s.r(t),s.d(t,{DEFAULT_CELL_SIZE:()=>d,WorldMap:()=>w});var i=s(2971),a=s(2404),h=s(5714);const r=s.p+"c8f55e9ef9e4d3c0a223a3adaad7ad23.jpg";var n=s(3077),o=s(517),c=s(7938),l=s(9529);const d=100;class w{constructor(e){this.cells=new Map,this.scene=e,this.material=new o.F("ground material",e);const t=new n.g(r,e);this.material.diffuseTexture=t,t.uScale=10,t.vScale=10,e.fogMode=i.Z.FOGMODE_LINEAR,e.fogStart=20,e.fogEnd=120,e.fogColor=new l.v9(.9,.9,.85),e.fogDensity=.03,e.clearColor=new l.ov(.9,.9,.85,1),this.debugMaterial=new o.F("BlueMaterial",e),this.debugMaterial.diffuseColor=new l.v9(.5,.4,.8),this.debugMaterial.emissiveColor=new l.v9(.5,.4,.8)}update(e,t){const s=[[e+1,t+1],[e+1,t],[e+1,t-1],[e,t+1],[e,t],[e,t-1],[e-1,t+1],[e-1,t],[e-1,t-1]];for(const e of s){const t=e[0],s=e[1];if(!this.cells.has(`${t},${s}`)){const e=this.createCell(this.scene,t,s);return this.cells.set(`${t},${s}`,e),void console.log(`Created cell ${t},${s}`)}}for(const s of this.cells.keys()){const[i,a]=s.split(","),h=parseInt(i),r=parseInt(a);if(h<e-1||h>e+1||r<t-1||r>t+1){const e=this.cells.get(s);e&&(this.scene.removeMesh(e),e.dispose(),this.cells.delete(s))}}}createCell(e,t,s){const i=a.P.CreateGround("ground",{width:d,height:d,subdivisions:2},e);i.position.set(t*d,0,s*d),i.physicsImpostor=new h.j(i,h.j.BoxImpostor,{mass:0,friction:.5,restitution:.7},e);const r=d/2,n=a.P.CreateBox("box",{width:1,depth:1,height:4},this.scene);n.material=this.debugMaterial,i.addChild(n);const o=a.P.CreateBox("box",{width:1,depth:1,height:8},this.scene);o.material=this.debugMaterial,o.position.set(t*d+r,4,s*d+r),i.addChild(o);const l=a.P.CreateBox("box",{width:1,depth:1,height:8},this.scene);return l.material=this.debugMaterial,l.position.set(t*d-r,4,s*d-r),i.addChild(l),new c.Boxes(this.scene).cellBoxes(d,i),i.material=this.material,i}}},2783:()=>{},6171:()=>{}}]);
//# sourceMappingURL=985.babylonBundle.js.map