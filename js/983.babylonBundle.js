"use strict";(self.webpackChunktrans_america=self.webpackChunktrans_america||[]).push([[983,443],{73443:(e,t,i)=>{i.r(t),i.d(t,{Car:()=>c,ModelCar:()=>l,WheelIndex:()=>s});var s,h=i(65694),n=i(89529),a=i(32404),r=i(55163);!function(e){e[e.FRONT_LEFT=0]="FRONT_LEFT",e[e.FRONT_RIGHT=1]="FRONT_RIGHT",e[e.BACK_LEFT=2]="BACK_LEFT",e[e.BACK_RIGHT=3]="BACK_RIGHT"}(s||(s={}));class o{constructor(e,t,i,s,h){this.position=1,this.halfTrack=1,this.height=.4,this.radius=.4,this.width=.3,this.position=e,this.halfTrack=t,this.height=i,this.radius=s,this.width=h}}class c{constructor(e,t){this.ZERO_QUATERNION=new n.PT,this.chassisWidth=1.8,this.chassisHeight=.6,this.chassisLength=4,this.massVehicle=200,this.backWheelAxisConfig=new o(-.92,.45,.25,.27,.3),this.frontWheelAxisConfig=new o(.6,.45,.18,.27,.3),this.friction=5,this.suspension={stiffness:10,damping:.3,compression:4.4,restLength:.6},this.rollInfluence=0,this.steeringIncrement=.01,this.steeringClamp=.2,this.maxEngineForce=500,this.maxBreakingForce=10,this.incEngine=10,this.vehicleSteering=0,this.engineForce=0,this.breakingForce=0,this.wheelMeshes=[],this.vehicleReady=!1,this.scene=e,this.ammoModule=t,this.greenMaterial=new h.StandardMaterial("GreenMaterial",e),this.greenMaterial.diffuseColor=new n.v9(.1,.8,.5),this.greenMaterial.emissiveColor=new n.v9(.1,.8,.5),this.blackMaterial=new h.StandardMaterial("BlackMaterial",e),this.blackMaterial.diffuseColor=new n.v9(.1,.1,.1),this.blackMaterial.emissiveColor=new n.v9(.1,.1,.1);const i=e.getPhysicsEngine()?.getPhysicsPlugin()?.world;this.wheelDirectionCS0=new t.btVector3(0,-1,0),this.wheelAxleCS=new t.btVector3(-1,0,0),this.chassisMesh=this.createChassisMesh(this.chassisWidth,this.chassisHeight,this.chassisLength);let a=this.chassisMesh.getBoundingInfo().boundingBox.extendSize;const r=new t.btBoxShape(new t.btVector3(a.x,a.y,a.z)),c=new t.btTransform;c.setIdentity(),c.setOrigin(new t.btVector3(0,5,0)),c.setRotation(new t.btQuaternion(this.ZERO_QUATERNION.x,this.ZERO_QUATERNION.y,this.ZERO_QUATERNION.z,this.ZERO_QUATERNION.w));const l=new t.btDefaultMotionState(c),g=new t.btVector3(0,0,0);r.calculateLocalInertia(this.massVehicle,g);const d=new t.btVector3(0,.4,0),f=new t.btTransform;f.setIdentity(),f.setOrigin(d);const w=new t.btCompoundShape;w.addChildShape(f,r);const p=new t.btRigidBody(new t.btRigidBodyConstructionInfo(this.massVehicle,l,w,g));p.setActivationState(4),i.addRigidBody(p),this.tuning=new t.btVehicleTuning;const C=new t.btDefaultVehicleRaycaster(i);this.vehicle=new t.btRaycastVehicle(this.tuning,p,C),this.vehicle.setCoordinateSystem(0,1,2),i.addAction(this.vehicle),this.vehicle.getChassisWorldTransform(),this.addWheelToVehicle(!0,new t.btVector3(this.frontWheelAxisConfig.halfTrack,this.frontWheelAxisConfig.height,this.frontWheelAxisConfig.position),this.frontWheelAxisConfig.radius,this.frontWheelAxisConfig.width,s.FRONT_LEFT),this.addWheelToVehicle(!0,new t.btVector3(-this.frontWheelAxisConfig.halfTrack,this.frontWheelAxisConfig.height,this.frontWheelAxisConfig.position),this.frontWheelAxisConfig.radius,this.frontWheelAxisConfig.width,s.FRONT_RIGHT),this.addWheelToVehicle(!1,new t.btVector3(-this.backWheelAxisConfig.halfTrack,this.backWheelAxisConfig.height,this.backWheelAxisConfig.position),this.backWheelAxisConfig.radius,this.backWheelAxisConfig.width,s.BACK_LEFT),this.addWheelToVehicle(!1,new t.btVector3(this.backWheelAxisConfig.halfTrack,this.backWheelAxisConfig.height,this.backWheelAxisConfig.position),this.backWheelAxisConfig.radius,this.backWheelAxisConfig.width,s.BACK_RIGHT),this.vehicleReady=!0,this.body=p}setPosition(e){const t=new this.ammoModule.btVector3(e.x,e.y,e.z),i=new this.ammoModule.btTransform;i.setOrigin(t),i.setRotation(new this.ammoModule.btQuaternion(this.ZERO_QUATERNION.x,this.ZERO_QUATERNION.y,this.ZERO_QUATERNION.z,this.ZERO_QUATERNION.w)),this.body.setWorldTransform(i)}createChassisMesh(e,t,i){const s=a.P.CreateBox("chassis",{width:e,depth:i,height:t},this.scene);return s.material=this.greenMaterial,s}addWheelToVehicle(e,t,i,s,h){const n=this.vehicle.addWheel(t,this.wheelDirectionCS0,this.wheelAxleCS,this.suspension.restLength,i,this.tuning,e);n.set_m_suspensionStiffness(this.suspension.stiffness),n.set_m_wheelsDampingRelaxation(this.suspension.damping),n.set_m_wheelsDampingCompression(this.suspension.compression),n.set_m_maxSuspensionForce(6e5),n.set_m_frictionSlip(40),n.set_m_rollInfluence(this.rollInfluence),this.wheelMeshes[h]=this.createWheelMesh(i,s,h)}createWheelMesh(e,t,i){const s=a.P.CreateCylinder("Wheel",{diameter:3*e,height:t,tessellation:6},this.scene);return s.rotationQuaternion=new n.PT,s.material=this.greenMaterial,s}}class l extends c{constructor(e,t,i,s){super(e,t),this.scene=e}prepareMesh(e){let t=this.scene.getMeshById(e);return t.rotation=new n.Pq(0,Math.PI,Math.PI),t}createWheelMesh(e,t,i){let h=super.createWheelMesh(e,t,i);switch(i){case s.FRONT_LEFT:let e=this.scene.getMeshById("wheel-front-left");e.rotation=new n.Pq(0,0,Math.PI/2),e.position.set(0,0,0),h.addChild(e);break;case s.FRONT_RIGHT:let t=this.scene.getMeshById("wheel-front-right");t.rotation=new n.Pq(0,0,Math.PI/2),t.position.set(0,0,0),h.addChild(t);break;case s.BACK_LEFT:let i=this.scene.getMeshById("wheel-back-left");i.rotation=new n.Pq(0,0,-Math.PI/2),i.position.set(0,0,0),h.addChild(i);break;case s.BACK_RIGHT:let a=this.scene.getMeshById("wheel-back-right");a.rotation=new n.Pq(0,0,-Math.PI/2),a.position.set(0,0,0),h.addChild(a)}return h.visibility=r.CONFIGURATION.debug?.5:0,h}createChassisMesh(e,t,i){console.log("createChassisMesh");let s=this.prepareMesh("body"),h=s.getBoundingInfo().boundingBox.extendSize,n=super.createChassisMesh(2*h.x,2*h.y,2*h.z);return n.addChild(s),n.visibility=r.CONFIGURATION.debug?.2:0,n}}},16983:(e,t,i)=>{i.r(t),i.d(t,{CarControls:()=>g,GlobalControls:()=>l});var s=i(89529),h=i(73443),n=i(75058),a=i(65694),r=i(98070);const o=new Map([["acceleration",!1],["braking",!1],["right",!1],["left",!1],["reset",!1],["flip",!1],["stop",!1]]),c=new Map([["KeyW","acceleration"],["KeyS","braking"],["KeyA","left"],["KeyD","right"],["KeyR","reset"],["KeyF","flip"],["Space","stop"]]);class l{constructor(e){window.addEventListener("keypress",(t=>{if("KeyI"===t.code&&(n.Inspector.IsVisible?n.Inspector.Hide():n.Inspector.Show(e,{})),"KeyO"===t.code){let t=new a.SceneOptimizerOptions,i=new a.SceneOptimizer(e,t);i.onNewOptimizationAppliedObservable.add((e=>{r.N.message("New optimization"+e.getDescription())})),i.onFailureObservable.add(((e,t)=>{r.N.message("FAILED to optimize scene")})),i.onSuccessObservable.add(((e,t)=>{r.N.message("SUCCESS to optimize scene")})),i.start()}}))}}class g{constructor(e,t,i){this.car=e,this.camera=t,this.resetPosition=i,window.addEventListener("keydown",this.keydown),window.addEventListener("keyup",this.keyup)}update(){if(this.car.vehicleReady){const e=this.car.vehicle.getCurrentSpeedKmHour();if(this.car.breakingForce=0,this.car.engineForce=0,o.get("reset")&&(this.car.setPosition(this.resetPosition),console.log("reset "+this.car.chassisMesh.position),this.camera.reset(),this.camera.lockedTarget=this.car.chassisMesh),o.get("flip")){let e=this.car.chassisMesh.position;this.car.setPosition(new s.Pq(e.x,this.resetPosition.y,e.z))}let t,i,n,a;o.get("acceleration")?e<-1?this.car.breakingForce=this.car.maxBreakingForce:this.car.engineForce=this.car.maxEngineForce:o.get("braking")?e>1?this.car.breakingForce=this.car.maxBreakingForce:this.car.engineForce=-this.car.maxEngineForce:o.get("stop")&&(e>1?this.car.breakingForce=2*this.car.maxBreakingForce:e<-1&&(this.car.engineForce=2*this.car.maxEngineForce)),o.get("right")?this.car.vehicleSteering<this.car.steeringClamp&&(this.car.vehicleSteering+=this.car.steeringIncrement):o.get("left")?this.car.vehicleSteering>-this.car.steeringClamp&&(this.car.vehicleSteering-=this.car.steeringIncrement):this.car.vehicleSteering=0,this.car.vehicle.applyEngineForce(this.car.engineForce,h.WheelIndex.FRONT_LEFT),this.car.vehicle.applyEngineForce(this.car.engineForce,h.WheelIndex.FRONT_RIGHT),this.car.vehicle.setBrake(this.car.breakingForce/2,h.WheelIndex.FRONT_LEFT),this.car.vehicle.setBrake(this.car.breakingForce/2,h.WheelIndex.FRONT_RIGHT),this.car.vehicle.setBrake(this.car.breakingForce,h.WheelIndex.BACK_LEFT),this.car.vehicle.setBrake(this.car.breakingForce,h.WheelIndex.BACK_RIGHT),this.car.vehicle.setSteeringValue(this.car.vehicleSteering,h.WheelIndex.FRONT_LEFT),this.car.vehicle.setSteeringValue(this.car.vehicleSteering,h.WheelIndex.FRONT_RIGHT);const r=this.car.vehicle.getNumWheels();for(a=0;a<r;a++){this.car.vehicle.updateWheelTransform(a,!0),t=this.car.vehicle.getWheelTransformWS(a),i=t.getOrigin(),n=t.getRotation();const e=this.car.wheelMeshes[a];e.position.set(i.x(),i.y(),i.z()),e.rotationQuaternion?.set(n.x(),n.y(),n.z(),n.w()),e.rotate(s._0.Z,Math.PI/2)}t=this.car.vehicle.getChassisWorldTransform(),i=t.getOrigin(),n=t.getRotation(),this.car.chassisMesh.position.set(i.x(),i.y(),i.z()),this.car.chassisMesh.rotationQuaternion?.set(n.x(),n.y(),n.z(),n.w()),this.car.chassisMesh.rotate(s._0.X,Math.PI)}}keyup(e){c.get(e.code)&&o.set(c.get(e.code)??"",!1)}keydown(e){c.get(e.code)&&o.set(c.get(e.code)??"",!0)}}}}]);