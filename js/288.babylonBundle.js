"use strict";(self.webpackChunktrans_america=self.webpackChunktrans_america||[]).push([[288,487],{4487:(e,t,s)=>{s.r(t),s.d(t,{Boxes:()=>c});var a=s(517),n=s(9529),r=s(2404),o=s(5714),i=s(3077);const l=s.p+"03713868bab7dd2e96995060bf2ae0f5.png";class c{constructor(e){this.scene=e,this.blueMaterial=new a.F("BlueMaterial",e),this.blueMaterial.diffuseColor=new n.v9(.5,.4,.8),this.blueMaterial.emissiveColor=new n.v9(.5,.4,.8),this.concreteMaterial=new a.F("concrete material",e),this.concreteMaterial.diffuseTexture=new i.g(l,e)}baseBoxes(){this.createBox(new n.Pq(4,1,12),new n.Pq(0,0,25),new n.Pq(-Math.PI/8,0,0),0),this.createBox(new n.Pq(4,1,12),new n.Pq(25,0,0),new n.Pq(-Math.PI/8,Math.PI/2,0),0),this.createBox(new n.Pq(4,1,12),new n.Pq(0,0,-25),new n.Pq(Math.PI/8,0,0),0),this.createBox(new n.Pq(4,1,12),new n.Pq(-25,0,0),new n.Pq(Math.PI/8,Math.PI/2,0),0)}randomBoxes(){const e=new n.Pq,t=new n.Pq,s=new n.Pq;for(let a=0;a<20;a++){const a=300*Math.random()-150+5,n=300*Math.random()-150+5,r=10*Math.random();e.set(r,r,r),t.set(n,0,a),s.set(a,a,a),this.createBox(e,t,s,0)}for(let a=0;a<30;a++){const a=300*Math.random()-150+5,n=300*Math.random()-150+5,r=3*Math.random();e.set(r,r,r),t.set(n,0,a),s.set(a,a,a),this.createBox(e,t,s,5)}}createBox(e,t,s,a){const n=r.P.CreateBox("box",{width:e.x,depth:e.z,height:e.y},this.scene);return n.position.set(t.x,t.y,t.z),n.rotation.set(s.x,s.y,s.z),a?(n.position.y+=5,n.material=this.blueMaterial):(a=0,n.material=this.concreteMaterial),n.physicsImpostor=new o.j(n,o.j.BoxImpostor,{mass:a,friction:.5,restitution:.7},this.scene),n}cellBoxes(e,t){const s=e/2,a=new n.Pq,r=new n.Pq,o=new n.Pq;for(let n=0;n<20;n++){const n=Math.random()*e-s,i=Math.random()*e-s,l=10*Math.random();a.set(l,l,l),r.set(i,0,n),o.set(n,n,n),this.createBox(a,r,o,0).parent=t}}createCellBox(e,t,s,a){const n=r.P.CreateBox("box",{width:e.x,depth:e.z,height:e.y});return n.position.set(t.x,t.y,t.z),n.rotation.set(s.x,s.y,s.z),a?(n.position.y+=5,n.material=this.blueMaterial):(a=0,n.material=this.concreteMaterial),n.physicsImpostor=new o.j(n,o.j.BoxImpostor,{mass:a,friction:.5,restitution:.7},this.scene),n}}},5112:(e,t,s)=>{s.r(t),s.d(t,{Cell:()=>f,CellFactory:()=>p,DEFAULT_CELL_DATA:()=>u});var a=s(517),n=s(2404),r=s(5714),o=s(2629),i=s(3077);const l=s.p+"c8f55e9ef9e4d3c0a223a3adaad7ad23.jpg",c=s.p+"c77efafbfaba1476dc4fbf577bd891b4.jpg",h=s.p+"6d13a2bb82c1085c7c8712db8fdbb67d.png",d=s.p+"9eb88e8ed885e9a4938dd174f39a0833.png";var m=s(9529);const u={id:"._.",name:"Unknown",surface:"unknown"};var w;!function(e){e.GRASS="grass",e.WALL="wall",e.OCEAN="ocean",e.SAND="sand",e.SNOW="snow",e.WATER="water"}(w||(w={}));class f{constructor(e,t){this.name=e,this.mesh=t}}class p{constructor(e){this.scene=e,this.sandMaterial=new a.F("sand material",e);const t=new i.g(l,e);t.vScale=10,t.uScale=10,this.sandMaterial.diffuseTexture=t,this.grassMaterial=new a.F("grass material",e);const s=new i.g(c,e);s.uScale=10,s.vScale=10,this.grassMaterial.diffuseTexture=s,this.oceanMaterial=new a.F("ocean material",e);const n=new i.g(h,e);n.uScale=10,n.vScale=10,this.oceanMaterial.diffuseTexture=n,this.wallMaterial=new a.F("wall material",e);const r=new i.g(d,e);r.uScale=10,r.vScale=10,this.wallMaterial.diffuseTexture=r,this.debugMaterial=new a.F("BlueMaterial",e),this.debugMaterial.diffuseColor=new m.v9(.5,.4,.8),this.debugMaterial.emissiveColor=new m.v9(.5,.4,.8),this.snowMaterial=new a.F("snow material",e),this.snowMaterial.diffuseColor=new m.v9(1,1,1),this.snowMaterial.emissiveColor=new m.v9(1,1,1)}createCell(e,t,s,a){switch(a.surface){case w.SAND:return new M(e,t,s,a.name,this.sandMaterial);case w.GRASS:return new M(e,t,s,a.name,this.grassMaterial);case w.WALL:return new x(e,t,s,a.name,this.wallMaterial);case w.OCEAN:case w.WATER:return new M(e,t,s,a.name,this.oceanMaterial);case w.SNOW:return new M(e,t,s,a.name,this.snowMaterial);default:return new M(e,t,s,a.name,this.debugMaterial)}}}class M extends f{constructor(e,t,s,a,i){super(a,n.P.CreateGround("ground",{width:o.DEFAULT_CELL_SIZE,height:o.DEFAULT_CELL_SIZE,subdivisions:2},e)),this.mesh.position.set(t*o.DEFAULT_CELL_SIZE,0,s*o.DEFAULT_CELL_SIZE),this.mesh.physicsImpostor=new r.j(this.mesh,r.j.BoxImpostor,{mass:0,friction:.5,restitution:.7},e),this.mesh.material=i}}class x extends f{constructor(e,t,s,a,i){super(a,n.P.CreateBox("cube",{size:o.DEFAULT_CELL_SIZE},e)),this.mesh.position.set(t*o.DEFAULT_CELL_SIZE,0,s*o.DEFAULT_CELL_SIZE),this.mesh.physicsImpostor=new r.j(this.mesh,r.j.BoxImpostor,{mass:0,friction:.5,restitution:.7},e),this.mesh.material=i}}},2629:(e,t,s)=>{s.r(t),s.d(t,{DEFAULT_CELL_SIZE:()=>h,WorldMap:()=>d});var a=s(2971),n=s(3325);const r=s.p+"51a9ce4c9839dfc9f58a2fb7ed4db5ee.txt";var o=s(4487),i=s(9529),l=s(8070),c=s(5112);const h=100;class d{constructor(e){this.cells=new Map,this.lastX=-9999,this.lastZ=-9999,this.noUpdateNeeded=!1,this.mapData={},this.mapMatrix=function(e,t,s=0){return Array.from({length:e},(()=>Array.from({length:t},(()=>s))))}(64,35,c.DEFAULT_CELL_DATA),this.mapLoaded=!1,this.scene=e,this.cellFactory=new c.CellFactory(e),this.boxFactory=new o.Boxes(e);let t=this,s=new n.rw3(e),l=s.addTextFileTask("task",r);s.onTaskError=function(e){alert("error while loading "+e.name)},l.onError=function(e,t,s){alert(t),alert(s)},l.onSuccess=function(e){t.mapData=JSON.parse(e.text);for(let e of t.mapData.cells)try{let s=e.col,a=e.row;t.mapMatrix[s][a]={id:s+"_"+a,name:e.name,surface:e.surface}}catch(t){console.error("Error parsing cell",e)}console.log(`COLS ${t.mapMatrix.length}`),console.log(`ROWS ${t.mapMatrix[0].length}`);for(let e of t.mapMatrix){let t="";for(let s of e)t+=s.surface[0];console.log(t)}},s.onFinish=function(e){console.log("done loading"),t.mapLoaded=!0},s.load(),e.fogMode=a.Z.FOGMODE_LINEAR,e.fogStart=20,e.fogEnd=120,e.fogColor=new i.v9(.9,.9,.85),e.fogDensity=.03,e.clearColor=new i.ov(.9,.9,.85,1)}update(e,t){return!(this.lastX!==e||this.lastZ!==t||!this.noUpdateNeeded)||(this.lastX=e,this.lastZ=t,l.Xz.innerHTML=e+","+t,l.Iq.style.left=5*e+"px",l.Iq.style.top=170-5*t+"px",l.wm.innerHTML=this.cells.get(`${e}_${t}`)?.name||"Failure",this.mapLoaded?(this.noUpdateNeeded=this.updateInternal(e,t),this.noUpdateNeeded):(console.log("NOT READY!"),!0))}updateInternal(e,t){const s=[[e+1,t+1],[e+1,t],[e+1,t-1],[e,t+1],[e,t],[e,t-1],[e-1,t+1],[e-1,t],[e-1,t-1]];for(const e of s){const t=e[0],s=e[1];let a=`${t}_${s}`;if(!this.cells.has(a)){this.cells.set(a,null);let e=c.DEFAULT_CELL_DATA;t>=0&&s>=0&&t<64&&s<35?e=this.mapMatrix[t][s]:console.log(`Out of bounds ${t},${s}`);let n={id:e.id,name:e.name,surface:e.surface};const r=this.cellFactory.createCell(this.scene,t,s,n);return"Somewhere"!=r.name&&"Unknown"!=r.name&&this.boxFactory.cellBoxes(h,r.mesh),this.cells.set(a,r),!1}}for(const s of this.cells.keys()){const[a,n]=s.split(","),r=parseInt(a),o=parseInt(n);if(r<e-1||r>e+1||o<t-1||o>t+1){const e=this.cells.get(s);e&&(this.scene.removeMesh(e.mesh),e.mesh.dispose(),this.cells.delete(s))}}return!0}}}}]);