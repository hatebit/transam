"use strict";(self.webpackChunktrans_america=self.webpackChunktrans_america||[]).push([[508,900],{53508:(e,t,r)=>{r.r(t),r.d(t,{_ENVTextureLoader:()=>a});var n=r(82942);class a{constructor(){this.supportCascades=!1}loadCubeData(e,t,r,a,o){if(Array.isArray(e))return;const i=(0,n.cU)(e);if(i){t.width=i.width,t.height=i.width;try{(0,n.ow)(t,i),(0,n.o5)(t,e,i).then((()=>{t.isReady=!0,t.onLoadedObservable.notifyObservers(t),t.onLoadedObservable.clear(),a&&a()}),(e=>{o?.("Can not upload environment levels",e)}))}catch(e){o?.("Can not upload environment file",e)}}else o&&o("Can not parse the environment file",null)}loadData(){throw".env not supported in 2d."}}},45688:(e,t,r)=>{var n=r(9783),a=r(85682);a.t.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(a.t.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=n.d.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((e=>{this._texture._sphericalPolynomial=e,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(e){this._texture&&(this._texture._sphericalPolynomial=e)},enumerable:!0,configurable:!0})},29900:(e,t,r)=>{r.r(t),r.d(t,{Dispose:()=>d,DumpData:()=>c,DumpDataAsync:()=>p,DumpFramebuffer:()=>u,DumpTools:()=>f});var n=r(33155),a=r(90066),o=r(49111),i=r(69583);let l,s=null;async function u(e,t,r,n,a="image/png",o,i){const l=await r.readPixels(0,0,e,t);c(e,t,new Uint8Array(l.buffer),n,a,o,!0,void 0,i)}function p(e,t,r,n="image/png",a,o=!1,i=!1,l){return new Promise((s=>{c(e,t,r,(e=>s(e)),n,a,o,i,l)}))}function c(e,t,u,p,c="image/png",f,y=!1,h=!1,m){(async function(){return s||(s=new Promise(((e,t)=>{let a,o=null;const s={preserveDrawingBuffer:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(r.bind(r,30418)).then((({ThinEngine:u})=>{try{a=new OffscreenCanvas(100,100),o=new u(a,!1,s)}catch(e){a=document.createElement("canvas"),o=new u(a,!1,s)}i.q.Instances.pop(),i.q.OnEnginesDisposedObservable.add((e=>{o&&e!==o&&!o.isDisposed&&0===i.q.Instances.length&&d()})),o.getCaps().parallelShaderCompile=void 0;const p=new n.J(o);r.e(752).then(r.bind(r,38752)).then((({passPixelShader:r})=>{if(!o)return void t("Engine is not defined");const i=new n.$({engine:o,name:r.name,fragmentShader:r.shader,samplerNames:["textureSampler"]});l={canvas:a,engine:o,renderer:p,wrapper:i},e(l)}))})).catch(t)}))),await s})().then((r=>{if(r.engine.setSize(e,t,!0),u instanceof Float32Array){const e=new Uint8Array(u.length);let t=u.length;for(;t--;){const r=u[t];e[t]=Math.round(255*(0,o.Clamp)(r))}u=e}const n=r.engine.createRawTexture(u,e,t,5,!1,!y,1);r.renderer.setViewport(),r.renderer.applyEffectWrapper(r.wrapper),r.wrapper.effect._bindTexture("textureSampler",n),r.renderer.draw(),h?a.S0.ToBlob(r.canvas,(e=>{const t=new FileReader;t.onload=e=>{const t=e.target.result;p&&p(t)},t.readAsArrayBuffer(e)}),c,m):a.S0.EncodeScreenshotCanvasData(r.canvas,p,c,f,m),n.dispose()}))}function d(){l?(l.wrapper.dispose(),l.renderer.dispose(),l.engine.dispose()):s?.then((e=>{e.wrapper.dispose(),e.renderer.dispose(),e.engine.dispose()})),s=null,l=null}const f={DumpData:c,DumpDataAsync:p,DumpFramebuffer:u,Dispose:d};a.S0.DumpData=c,a.S0.DumpDataAsync=p,a.S0.DumpFramebuffer=u},82942:(e,t,r)=>{r.d(t,{$h:()=>b,Hx:()=>w,RZ:()=>g,bv:()=>P,cU:()=>x,gW:()=>D,o5:()=>T,ow:()=>A,qY:()=>R});var n=r(90066),a=r(54983),o=r(49111),i=r(47369),l=r(58478),s=r(85682),u=r(86521),p=r(71015),c=r(70461),d=r(68642),f=(r(45688),r(29900));const y="image/png",h=2,m=[134,22,135,150,246,214,150,54];function x(e){const t=new DataView(e.buffer,e.byteOffset,e.byteLength);let r=0;for(let e=0;e<m.length;e++)if(t.getUint8(r++)!==m[e])return c.V.Error("Not a babylon environment map"),null;let n="",a=0;for(;a=t.getUint8(r++);)n+=String.fromCharCode(a);let o=JSON.parse(n);return o=g(o),o.specular&&(o.specular.specularDataPosition=r,o.specular.lodGenerationScale=o.specular.lodGenerationScale||.8),o}function g(e){if(e.version>h)throw new Error(`Unsupported babylon environment map version "${e.version}". Latest supported version is "${h}".`);return 2===e.version?e:e={...e,version:2,imageType:y}}async function w(e,t={}){const r=e.getInternalTexture();if(!r)return Promise.reject("The cube texture is invalid.");const n=t.imageType??y,a=r.getEngine();if(2!==e.textureType&&1!==e.textureType&&0!==e.textureType&&0!==e.textureType&&7!==e.textureType&&-1!==e.textureType)return Promise.reject("The cube texture should allow HDR (Full Float or Half Float).");let i=1;if(!a.getCaps().textureFloatRender&&(i=2,!a.getCaps().textureHalfFloatRender))return Promise.reject("Env texture can only be created when the browser supports half float or full float rendering.");e.sphericalPolynomial;const l=e.getInternalTexture()?._sphericalPolynomialPromise,s=r.width,p=new u.Z(a),c={};a.flushFramebuffer();const x=(0,o.ILog2)(r.width);for(let r=0;r<=x;r++){const o=Math.pow(2,x-r);for(let l=0;l<6;l++){let s=await e.readPixels(l,r,void 0,!1);if(s&&s.byteLength===s.length){const e=new Float32Array(4*s.byteLength);for(let t=0;t<s.byteLength;t++)e[t]=s[t]/255,e[t]=Math.pow(e[t],2.2);s=e}else if(s&&e.gammaSpace){const e=s;for(let t=0;t<e.length;t++)e[t]=Math.pow(e[t],2.2)}const u=a.createRawTexture(s,o,o,5,!1,!0,1,null,i);await d.G.EncodeTextureToRGBD(u,p,i);const y=await a._readTexturePixels(u,o,o),h=await(0,f.DumpDataAsync)(o,o,y,n,void 0,!1,!0,t.imageQuality);c[6*r+l]=h,u.dispose()}}p.dispose(),l&&await l;const g={version:h,width:s,imageType:n,irradiance:_(e),specular:{mipmaps:[],lodGenerationScale:e.lodGenerationScale}};let w=0;for(let e=0;e<=x;e++)for(let t=0;t<6;t++){const r=c[6*e+t].byteLength;g.specular.mipmaps.push({length:r,position:w}),w+=r}const b=JSON.stringify(g),T=new ArrayBuffer(b.length+1),v=new Uint8Array(T);for(let e=0,t=b.length;e<t;e++)v[e]=b.charCodeAt(e);v[b.length]=0;const P=m.length+w+T.byteLength,A=new ArrayBuffer(P),D=new Uint8Array(A),R=new DataView(A);let z=0;for(let e=0;e<m.length;e++)R.setUint8(z++,m[e]);D.set(new Uint8Array(T),z),z+=T.byteLength;for(let e=0;e<=x;e++)for(let t=0;t<6;t++){const r=c[6*e+t];D.set(new Uint8Array(r),z),z+=r.byteLength}return A}function _(e){const t=e.sphericalPolynomial;return null==t?null:{x:[t.x.x,t.x.y,t.x.z],y:[t.y.x,t.y.y,t.y.z],z:[t.z.x,t.z.y,t.z.z],xx:[t.xx.x,t.xx.y,t.xx.z],yy:[t.yy.x,t.yy.y,t.yy.z],zz:[t.zz.x,t.zz.y,t.zz.z],yz:[t.yz.x,t.yz.y,t.yz.z],zx:[t.zx.x,t.zx.y,t.zx.z],xy:[t.xy.x,t.xy.y,t.xy.z]}}function b(e,t){const r=(t=g(t)).specular;let n=Math.log2(t.width);if(n=Math.round(n)+1,r.mipmaps.length!==6*n)throw new Error(`Unsupported specular mipmaps number "${r.mipmaps.length}"`);const a=new Array(n);for(let t=0;t<n;t++){a[t]=new Array(6);for(let n=0;n<6;n++){const o=r.mipmaps[6*t+n];a[t][n]=new Uint8Array(e.buffer,e.byteOffset+r.specularDataPosition+o.position,o.length)}}return a}function T(e,t,r){const n=(r=g(r)).specular;return n?(e._lodGenerationScale=n.lodGenerationScale,P(e,b(t,r),r.imageType)):Promise.resolve()}function v(e,t,r,n,a,o,i,l,s,u,p){return new Promise(((c,d)=>{if(r){const r=t.createTexture(null,!0,!0,null,1,null,(e=>{d(e)}),e);n?.onEffectCreatedObservable.addOnce((l=>{l.executeWhenCompiled((()=>{n.externalTextureSamplerBinding=!0,n.onApply=n=>{n._bindTexture("textureSampler",r),n.setFloat2("scale",1,t._features.needsInvertingBitmap&&e instanceof ImageBitmap?-1:1)},t.scenes.length&&(t.scenes[0].postProcessManager.directRender([n],u,!0,o,i),t.restoreDefaultFramebuffer(),r.dispose(),URL.revokeObjectURL(a),c())}))}))}else{if(t._uploadImageToTexture(p,e,o,i),l){const r=s[i];r&&t._uploadImageToTexture(r._texture,e,o,0)}c()}}))}async function P(e,t,a=y){if(!n.S0.IsExponentOfTwo(e.width))throw new Error("Texture size must be a power of two");const i=(0,o.ILog2)(e.width)+1,u=e.getEngine();let c=!1,d=!1,f=null,h=null,m=null;const x=u.getCaps();e.format=5,e.type=0,e.generateMipMaps=!0,e._cachedAnisotropicFilteringLevel=null,u.updateTextureSamplingMode(3,e),x.textureLOD?u._features.supportRenderAndCopyToLodForFloatTextures?x.textureHalfFloatRender&&x.textureHalfFloatLinearFiltering?(c=!0,e.type=2):x.textureFloatRender&&x.textureFloatLinearFiltering&&(c=!0,e.type=1):c=!1:(c=!1,d=!0,m={});let g=0;if(c)u.isWebGPU?(g=1,await r.e(143).then(r.bind(r,55143))):await r.e(606).then(r.bind(r,28606)),f=new p.w("rgbdDecode","rgbdDecode",null,null,1,null,3,u,!1,void 0,e.type,void 0,null,!1,void 0,g),e._isRGBD=!1,e.invertY=!1,h=u.createRenderTargetCubeTexture(e.width,{generateDepthBuffer:!1,generateMipMaps:!0,generateStencilBuffer:!1,samplingMode:3,type:e.type,format:5});else if(e._isRGBD=!0,e.invertY=!0,d){const t=3,r=e._lodGenerationScale,n=e._lodGenerationOffset;for(let a=0;a<t;a++){const o=(i-1)*r+n,p=n+(o-n)*(1-a/(t-1)),c=Math.round(Math.min(Math.max(p,0),o)),d=new l.hV(u,2);d.isCube=!0,d.invertY=!0,d.generateMipMaps=!1,u.updateTextureSamplingMode(2,d);const f=new s.t(null);switch(f._isCube=!0,f._texture=d,m[c]=f,a){case 0:e._lodTextureLow=f;break;case 1:e._lodTextureMid=f;break;case 2:e._lodTextureHigh=f}}}const w=[];for(let r=0;r<t.length;r++)for(let n=0;n<6;n++){const o=t[r][n],i=new Blob([o],{type:a}),l=URL.createObjectURL(i);let s;if(u._features.forceBitmapOverHTMLImageElement)s=u.createImageBitmap(i,{premultiplyAlpha:"none"}).then((t=>v(t,u,c,f,l,n,r,d,m,h,e)));else{const t=new Image;t.src=l,s=new Promise(((a,o)=>{t.onload=()=>{v(t,u,c,f,l,n,r,d,m,h,e).then((()=>a())).catch((e=>{o(e)}))},t.onerror=e=>{o(e)}}))}w.push(s)}if(t.length<i){let r;const n=Math.pow(2,i-1-t.length),a=n*n*4;switch(e.type){case 0:r=new Uint8Array(a);break;case 2:r=new Uint16Array(a);break;case 1:r=new Float32Array(a)}for(let n=t.length;n<i;n++)for(let t=0;t<6;t++)u._uploadArrayBufferViewToTexture(e,r,t,n)}return Promise.all(w).then((()=>{h&&(u._releaseTexture(e),h._swapAndDie(e)),f&&f.dispose(),d&&(e._lodTextureHigh&&e._lodTextureHigh._texture&&(e._lodTextureHigh._texture.isReady=!0),e._lodTextureMid&&e._lodTextureMid._texture&&(e._lodTextureMid._texture.isReady=!0),e._lodTextureLow&&e._lodTextureLow._texture&&(e._lodTextureLow._texture.isReady=!0))}))}function A(e,t){const r=(t=g(t)).irradiance;if(!r)return;const n=new i.Q;a.Pq.FromArrayToRef(r.x,0,n.x),a.Pq.FromArrayToRef(r.y,0,n.y),a.Pq.FromArrayToRef(r.z,0,n.z),a.Pq.FromArrayToRef(r.xx,0,n.xx),a.Pq.FromArrayToRef(r.yy,0,n.yy),a.Pq.FromArrayToRef(r.zz,0,n.zz),a.Pq.FromArrayToRef(r.yz,0,n.yz),a.Pq.FromArrayToRef(r.zx,0,n.zx),a.Pq.FromArrayToRef(r.xy,0,n.xy),e._sphericalPolynomial=n}function D(e,t,r,n,a){const o=P(e.getEngine().createRawCubeTexture(null,e.width,e.format,e.type,e.generateMipMaps,e.invertY,e.samplingMode,e._compression),t).then((()=>e));return e.onRebuildCallback=e=>({proxy:o,isReady:!0,isAsync:!0}),e._source=13,e._bufferViewArrayArray=t,e._lodGenerationScale=n,e._lodGenerationOffset=a,e._sphericalPolynomial=r,P(e,t).then((()=>(e.isReady=!0,e)))}const R={GetEnvInfo:x,CreateEnvTextureAsync:w,CreateImageDataArrayBufferViews:b,UploadEnvLevelsAsync:T,UploadLevelsAsync:P,UploadEnvSpherical:A}},68642:(e,t,r)=>{r.d(t,{G:()=>o});var n=r(71015),a=r(89783);class o{static ExpandRGBDTexture(e){const t=e._texture;if(!t||!e.isRGBD)return;const a=t.getEngine(),o=a.getCaps(),i=t.isReady;let l=!1;o.textureHalfFloatRender&&o.textureHalfFloatLinearFiltering?(l=!0,t.type=2):o.textureFloatRender&&o.textureFloatLinearFiltering&&(l=!0,t.type=1),l&&(t.isReady=!1,t._isRGBD=!1,t.invertY=!1);const s=async()=>{const o=a.isWebGPU,i=o?1:0;t.isReady=!1,o?await Promise.all([r.e(143).then(r.bind(r,55143)),r.e(7).then(r.bind(r,37007))]):await Promise.all([r.e(606).then(r.bind(r,28606)),r.e(677).then(r.bind(r,59058))]);const l=new n.w("rgbdDecode","rgbdDecode",null,null,1,null,3,a,!1,void 0,t.type,void 0,null,!1,void 0,i);l.externalTextureSamplerBinding=!0;const s=a.createRenderTargetTexture(t.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:t.samplingMode,type:t.type,format:5});l.onEffectCreatedObservable.addOnce((r=>{r.executeWhenCompiled((()=>{l.onApply=e=>{e._bindTexture("textureSampler",t),e.setFloat2("scale",1,1)},e.getScene().postProcessManager.directRender([l],s,!0),a.restoreDefaultFramebuffer(),a._releaseTexture(t),l&&l.dispose(),s._swapAndDie(t),t.isReady=!0}))}))};l&&(i?s():e.onLoadObservable.addOnce(s))}static EncodeTextureToRGBD(e,t,r=0){return(0,a.Qs)("rgbdEncode",e,t,r,1,5)}}}}]);