(self.webpackChunktrans_america=self.webpackChunktrans_america||[]).push([[611,487,26,443,288,983],{4487:(e,t,s)=>{"use strict";s.r(t),s.d(t,{Boxes:()=>c});var i=s(517),a=s(9529),r=s(2404),n=s(5714),h=s(3077);const o=s.p+"03713868bab7dd2e96995060bf2ae0f5.png";class c{constructor(e){this.scene=e,this.blueMaterial=new i.F("BlueMaterial",e),this.blueMaterial.diffuseColor=new a.v9(.5,.4,.8),this.blueMaterial.emissiveColor=new a.v9(.5,.4,.8),this.concreteMaterial=new i.F("concrete material",e),this.concreteMaterial.diffuseTexture=new h.g(o,e)}baseBoxes(){this.createBox(new a.Pq(4,1,12),new a.Pq(0,0,25),new a.Pq(-Math.PI/8,0,0),0),this.createBox(new a.Pq(4,1,12),new a.Pq(25,0,0),new a.Pq(-Math.PI/8,Math.PI/2,0),0),this.createBox(new a.Pq(4,1,12),new a.Pq(0,0,-25),new a.Pq(Math.PI/8,0,0),0),this.createBox(new a.Pq(4,1,12),new a.Pq(-25,0,0),new a.Pq(Math.PI/8,Math.PI/2,0),0)}randomBoxes(){const e=new a.Pq,t=new a.Pq,s=new a.Pq;for(let i=0;i<20;i++){const i=300*Math.random()-150+5,a=300*Math.random()-150+5,r=10*Math.random();e.set(r,r,r),t.set(a,0,i),s.set(i,i,i),this.createBox(e,t,s,0)}for(let i=0;i<30;i++){const i=300*Math.random()-150+5,a=300*Math.random()-150+5,r=3*Math.random();e.set(r,r,r),t.set(a,0,i),s.set(i,i,i),this.createBox(e,t,s,5)}}createBox(e,t,s,i){const a=r.P.CreateBox("box",{width:e.x,depth:e.z,height:e.y},this.scene);return a.position.set(t.x,t.y,t.z),a.rotation.set(s.x,s.y,s.z),i?(a.position.y+=5,a.material=this.blueMaterial):(i=0,a.material=this.concreteMaterial),a.physicsImpostor=new n.j(a,n.j.BoxImpostor,{mass:i,friction:.5,restitution:.7},this.scene),a}cellBoxes(e,t){const s=e/2,i=new a.Pq,r=new a.Pq,n=new a.Pq;for(let a=0;a<20;a++){const a=Math.random()*e-s,h=Math.random()*e-s,o=10*Math.random();i.set(o,o,o),r.set(h,0,a),n.set(a,a,a),this.createBox(i,r,n,0).parent=t}}createCellBox(e,t,s,i){const a=r.P.CreateBox("box",{width:e.x,depth:e.z,height:e.y});return a.position.set(t.x,t.y,t.z),a.rotation.set(s.x,s.y,s.z),i?(a.position.y+=5,a.material=this.blueMaterial):(i=0,a.material=this.concreteMaterial),a.physicsImpostor=new n.j(a,n.j.BoxImpostor,{mass:i,friction:.5,restitution:.7},this.scene),a}}},2026:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GameCamera:()=>r});var i=s(5709),a=s(9529);class r extends i.p{constructor(e,t){super("GameCamera",new a.Pq(0,10,-10),e,t),this.reset(),this.cameraAcceleration=.05,this.maxCameraSpeed=400,this.attachControl(!0)}reset(){this.radius=10,this.heightOffset=4,this.rotationOffset=0}}},3443:(e,t,s)=>{"use strict";s.r(t),s.d(t,{Car:()=>n});var i=s(3325),a=s(9529),r=s(2404);class n{constructor(e,t){this.ZERO_QUATERNION=new a.PT,this.FRONT_LEFT=0,this.FRONT_RIGHT=1,this.BACK_LEFT=2,this.BACK_RIGHT=3,this.chassisWidth=1.8,this.chassisHeight=.6,this.chassisLength=4,this.massVehicle=200,this.wheelAxisPositionBack=-1,this.wheelRadiusBack=.4,this.wheelWidthBack=.3,this.wheelHalfTrackBack=1,this.wheelAxisHeightBack=.4,this.wheelAxisFrontPosition=1,this.wheelHalfTrackFront=1,this.wheelAxisHeightFront=.4,this.wheelRadiusFront=.4,this.wheelWidthFront=.3,this.friction=5,this.suspension={stiffness:10,damping:.3,compression:4.4,restLength:.6},this.rollInfluence=0,this.steeringIncrement=.01,this.steeringClamp=.2,this.maxEngineForce=500,this.maxBreakingForce=10,this.incEngine=10,this.vehicleSteering=0,this.engineForce=0,this.breakingForce=0,this.wheelMeshes=[],this.vehicleReady=!1,this.greenMaterial=new i.FUi("GreenMaterial",e),this.greenMaterial.diffuseColor=new a.v9(.1,.8,.5),this.greenMaterial.emissiveColor=new a.v9(.1,.8,.5),this.blackMaterial=new i.FUi("BlackMaterial",e),this.blackMaterial.diffuseColor=new a.v9(.1,.1,.1),this.blackMaterial.emissiveColor=new a.v9(.1,.1,.1),this.scene=e;const s=e.getPhysicsEngine()?.getPhysicsPlugin().world;this.wheelDirectionCS0=new t.btVector3(0,-1,0),this.wheelAxleCS=new t.btVector3(-1,0,0);const r=new t.btBoxShape(new t.btVector3(.5*this.chassisWidth,.5*this.chassisHeight,.5*this.chassisLength)),n=new t.btTransform;n.setIdentity(),n.setOrigin(new t.btVector3(0,5,0)),n.setRotation(new t.btQuaternion(this.ZERO_QUATERNION.x,this.ZERO_QUATERNION.y,this.ZERO_QUATERNION.z,this.ZERO_QUATERNION.w));const h=new t.btDefaultMotionState(n),o=new t.btVector3(0,0,0);r.calculateLocalInertia(this.massVehicle,o),this.chassisMesh=this.createChassisMesh(this.chassisWidth,this.chassisHeight,this.chassisLength);const c=new t.btVector3(0,.4,0),l=new t.btTransform;l.setIdentity(),l.setOrigin(c);const d=new t.btCompoundShape;d.addChildShape(l,r);const w=new t.btRigidBody(new t.btRigidBodyConstructionInfo(this.massVehicle,h,d,o));w.setActivationState(4),s.addRigidBody(w),this.tuning=new t.btVehicleTuning;const g=new t.btDefaultVehicleRaycaster(s);this.vehicle=new t.btRaycastVehicle(this.tuning,w,g),this.vehicle.setCoordinateSystem(0,1,2),s.addAction(this.vehicle),this.vehicle.getChassisWorldTransform(),this.addWheelToVehicle(!0,new t.btVector3(this.wheelHalfTrackFront,this.wheelAxisHeightFront,this.wheelAxisFrontPosition),this.wheelRadiusFront,this.wheelWidthFront,this.FRONT_LEFT),this.addWheelToVehicle(!0,new t.btVector3(-this.wheelHalfTrackFront,this.wheelAxisHeightFront,this.wheelAxisFrontPosition),this.wheelRadiusFront,this.wheelWidthFront,this.FRONT_RIGHT),this.addWheelToVehicle(!1,new t.btVector3(-this.wheelHalfTrackBack,this.wheelAxisHeightBack,this.wheelAxisPositionBack),this.wheelRadiusBack,this.wheelWidthBack,this.BACK_LEFT),this.addWheelToVehicle(!1,new t.btVector3(this.wheelHalfTrackBack,this.wheelAxisHeightBack,this.wheelAxisPositionBack),this.wheelRadiusBack,this.wheelWidthBack,this.BACK_RIGHT),this.vehicleReady=!0,this.ammoModule=t,this.body=w}setPosition(e){const t=new this.ammoModule.btVector3(e.x,e.y,e.z),s=new this.ammoModule.btTransform;s.setOrigin(t),s.setRotation(new this.ammoModule.btQuaternion(this.ZERO_QUATERNION.x,this.ZERO_QUATERNION.y,this.ZERO_QUATERNION.z,this.ZERO_QUATERNION.w)),this.body.setWorldTransform(s)}createChassisMesh(e,t,s){const i=r.P.CreateBox("box",{width:e,depth:s,height:t},this.scene);return i.rotationQuaternion=new a.PT,i.material=this.greenMaterial,i}addWheelToVehicle(e,t,s,i,a){const r=this.vehicle.addWheel(t,this.wheelDirectionCS0,this.wheelAxleCS,this.suspension.restLength,s,this.tuning,e);r.set_m_suspensionStiffness(this.suspension.stiffness),r.set_m_wheelsDampingRelaxation(this.suspension.damping),r.set_m_wheelsDampingCompression(this.suspension.compression),r.set_m_maxSuspensionForce(6e5),r.set_m_frictionSlip(40),r.set_m_rollInfluence(this.rollInfluence),this.wheelMeshes[a]=this.createWheelMesh(s,i)}createWheelMesh(e,t){const s=r.P.CreateCylinder("Wheel",{diameter:1,height:.5,tessellation:6},this.scene);return s.rotationQuaternion=new a.PT,s.material=this.blackMaterial,s}}},5112:(e,t,s)=>{"use strict";s.r(t),s.d(t,{Cell:()=>u,CellFactory:()=>p,DEFAULT_CELL_DATA:()=>g});var i=s(517),a=s(2404),r=s(5714),n=s(2629),h=s(3077);const o=s.p+"c8f55e9ef9e4d3c0a223a3adaad7ad23.jpg",c=s.p+"c77efafbfaba1476dc4fbf577bd891b4.jpg",l=s.p+"6d13a2bb82c1085c7c8712db8fdbb67d.png",d=s.p+"9eb88e8ed885e9a4938dd174f39a0833.png";var w=s(9529);const g={id:"._.",name:"Unknown",surface:"unknown"};var m;!function(e){e.GRASS="grass",e.WALL="wall",e.OCEAN="ocean",e.SAND="sand",e.SNOW="snow",e.WATER="water"}(m||(m={}));class u{constructor(e,t){this.name=e,this.mesh=t}}class p{constructor(e){this.scene=e,this.sandMaterial=new i.F("sand material",e);const t=new h.g(o,e);t.vScale=10,t.uScale=10,this.sandMaterial.diffuseTexture=t,this.grassMaterial=new i.F("grass material",e);const s=new h.g(c,e);s.uScale=10,s.vScale=10,this.grassMaterial.diffuseTexture=s,this.oceanMaterial=new i.F("ocean material",e);const a=new h.g(l,e);a.uScale=10,a.vScale=10,this.oceanMaterial.diffuseTexture=a,this.wallMaterial=new i.F("wall material",e);const r=new h.g(d,e);r.uScale=10,r.vScale=10,this.wallMaterial.diffuseTexture=r,this.debugMaterial=new i.F("BlueMaterial",e),this.debugMaterial.diffuseColor=new w.v9(.5,.4,.8),this.debugMaterial.emissiveColor=new w.v9(.5,.4,.8),this.snowMaterial=new i.F("snow material",e),this.snowMaterial.diffuseColor=new w.v9(1,1,1),this.snowMaterial.emissiveColor=new w.v9(1,1,1)}createCell(e,t,s,i){switch(i.surface){case m.SAND:return new f(e,t,s,i.name,this.sandMaterial);case m.GRASS:return new f(e,t,s,i.name,this.grassMaterial);case m.WALL:return new M(e,t,s,i.name,this.wallMaterial);case m.OCEAN:case m.WATER:return new f(e,t,s,i.name,this.oceanMaterial);case m.SNOW:return new f(e,t,s,i.name,this.snowMaterial);default:return new f(e,t,s,i.name,this.debugMaterial)}}}class f extends u{constructor(e,t,s,i,h){super(i,a.P.CreateGround("ground",{width:n.DEFAULT_CELL_SIZE,height:n.DEFAULT_CELL_SIZE,subdivisions:2},e)),this.mesh.position.set(t*n.DEFAULT_CELL_SIZE,0,s*n.DEFAULT_CELL_SIZE),this.mesh.physicsImpostor=new r.j(this.mesh,r.j.BoxImpostor,{mass:0,friction:.5,restitution:.7},e),this.mesh.material=h}}class M extends u{constructor(e,t,s,i,h){super(i,a.P.CreateBox("cube",{size:n.DEFAULT_CELL_SIZE},e)),this.mesh.position.set(t*n.DEFAULT_CELL_SIZE,0,s*n.DEFAULT_CELL_SIZE),this.mesh.physicsImpostor=new r.j(this.mesh,r.j.BoxImpostor,{mass:0,friction:.5,restitution:.7},e),this.mesh.material=h}}},6983:(e,t,s)=>{"use strict";s.r(t),s.d(t,{Controls:()=>n});var i=s(9529);const a=new Map([["acceleration",!1],["braking",!1],["right",!1],["left",!1],["reset",!1],["stop",!1]]),r=new Map([["KeyW","acceleration"],["KeyS","braking"],["KeyA","left"],["KeyD","right"],["KeyR","reset"],["Space","stop"]]);class n{constructor(e,t,s){this.car=e,this.camera=t,this.resetPosition=s,window.addEventListener("keydown",this.keydown),window.addEventListener("keyup",this.keyup)}update(){if(this.car.vehicleReady){const e=this.car.vehicle.getCurrentSpeedKmHour();let t,s,r,n;this.car.breakingForce=0,this.car.engineForce=0,a.get("reset")&&(this.car.setPosition(this.resetPosition),console.log("reset "+this.car.chassisMesh.position),this.camera.reset(),this.camera.lockedTarget=this.car.chassisMesh),a.get("acceleration")?e<-1?this.car.breakingForce=this.car.maxBreakingForce:this.car.engineForce=this.car.maxEngineForce:a.get("braking")?e>1?this.car.breakingForce=this.car.maxBreakingForce:this.car.engineForce=-this.car.maxEngineForce:a.get("stop")&&(e>1?this.car.breakingForce=2*this.car.maxBreakingForce:e<-1&&(this.car.engineForce=2*this.car.maxEngineForce)),a.get("right")?this.car.vehicleSteering<this.car.steeringClamp&&(this.car.vehicleSteering+=this.car.steeringIncrement):a.get("left")?this.car.vehicleSteering>-this.car.steeringClamp&&(this.car.vehicleSteering-=this.car.steeringIncrement):this.car.vehicleSteering=0,this.car.vehicle.applyEngineForce(this.car.engineForce,this.car.FRONT_LEFT),this.car.vehicle.applyEngineForce(this.car.engineForce,this.car.FRONT_RIGHT),this.car.vehicle.setBrake(this.car.breakingForce/2,this.car.FRONT_LEFT),this.car.vehicle.setBrake(this.car.breakingForce/2,this.car.FRONT_RIGHT),this.car.vehicle.setBrake(this.car.breakingForce,this.car.BACK_LEFT),this.car.vehicle.setBrake(this.car.breakingForce,this.car.BACK_RIGHT),this.car.vehicle.setSteeringValue(this.car.vehicleSteering,this.car.FRONT_LEFT),this.car.vehicle.setSteeringValue(this.car.vehicleSteering,this.car.FRONT_RIGHT);const h=this.car.vehicle.getNumWheels();for(n=0;n<h;n++)this.car.vehicle.updateWheelTransform(n,!0),t=this.car.vehicle.getWheelTransformWS(n),s=t.getOrigin(),r=t.getRotation(),this.car.wheelMeshes[n].position.set(s.x(),s.y(),s.z()),this.car.wheelMeshes[n].rotationQuaternion?.set(r.x(),r.y(),r.z(),r.w()),this.car.wheelMeshes[n].rotate(i._0.Z,Math.PI/2);t=this.car.vehicle.getChassisWorldTransform(),s=t.getOrigin(),r=t.getRotation(),this.car.chassisMesh.position.set(s.x(),s.y(),s.z()),this.car.chassisMesh.rotationQuaternion?.set(r.x(),r.y(),r.z(),r.w()),this.car.chassisMesh.rotate(i._0.X,Math.PI)}}keyup(e){r.get(e.code)&&a.set(r.get(e.code)??"",!1)}keydown(e){r.get(e.code)&&a.set(r.get(e.code)??"",!0)}}},8827:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>u});var i=s(2971),a=s(4983),r=s(7069),n=s(5847),h=(s(1570),s(517),s(9846));let o;const c=new Promise((e=>{(new h).then((t=>{o=t,e(t)}))}));var l=s(3443),d=s(6983),w=s(2629),g=s(8070),m=s(2026);const u=new class{constructor(){this.preTasks=[c],this.createScene=async(e,t)=>{const s=new i.Z(e);new r.g("light",new a.Pq(0,1,0),s).intensity=.7,s.enablePhysics(new a.Pq(0,-10,0),new n.v(!0,o));let h=new a.Pq(4*w.DEFAULT_CELL_SIZE,20,26*w.DEFAULT_CELL_SIZE);const c=new l.Car(s,o);c.setPosition(h);const u=new m.GameCamera(s,c.chassisMesh),p=new w.WorldMap(s),f=new d.Controls(c,u,h);return s.activeCamera=u,s.registerBeforeRender((function(){e.getDeltaTime(),f.update();const t=c.chassisMesh.position,s=0|Math.round(t.x/w.DEFAULT_CELL_SIZE),i=0|Math.round(t.z/w.DEFAULT_CELL_SIZE);p.update(s,i);let a=e.getFps();g.L_.style.color=a<55?"red":"white",g.L_.innerHTML=a.toFixed()+" fps",g.Hq.innerHTML=Math.abs(c.vehicle.getCurrentSpeedKmHour().toFixed())+" km/h"})),s}}}},2629:(e,t,s)=>{"use strict";s.r(t),s.d(t,{DEFAULT_CELL_SIZE:()=>l,WorldMap:()=>d});var i=s(2971),a=s(3325);const r=s.p+"51a9ce4c9839dfc9f58a2fb7ed4db5ee.txt";var n=s(4487),h=s(9529),o=s(8070),c=s(5112);const l=100;class d{constructor(e){this.cells=new Map,this.lastX=-9999,this.lastZ=-9999,this.noUpdateNeeded=!1,this.mapData={},this.mapMatrix=function(e,t,s=0){return Array.from({length:e},(()=>Array.from({length:t},(()=>s))))}(64,35,c.DEFAULT_CELL_DATA),this.mapLoaded=!1,this.scene=e,this.cellFactory=new c.CellFactory(e),this.boxFactory=new n.Boxes(e);let t=this,s=new a.rw3(e),o=s.addTextFileTask("task",r);s.onTaskError=function(e){alert("error while loading "+e.name)},o.onError=function(e,t,s){alert(t),alert(s)},o.onSuccess=function(e){t.mapData=JSON.parse(e.text);for(let e of t.mapData.cells)try{let s=e.col,i=e.row;t.mapMatrix[s][i]={id:s+"_"+i,name:e.name,surface:e.surface}}catch(t){console.error("Error parsing cell",e)}console.log(`COLS ${t.mapMatrix.length}`),console.log(`ROWS ${t.mapMatrix[0].length}`);for(let e of t.mapMatrix){let t="";for(let s of e)t+=s.surface[0];console.log(t)}},s.onFinish=function(e){console.log("done loading"),t.mapLoaded=!0},s.load(),e.fogMode=i.Z.FOGMODE_LINEAR,e.fogStart=20,e.fogEnd=120,e.fogColor=new h.v9(.9,.9,.85),e.fogDensity=.03,e.clearColor=new h.ov(.9,.9,.85,1)}update(e,t){return!(this.lastX!==e||this.lastZ!==t||!this.noUpdateNeeded)||(this.lastX=e,this.lastZ=t,o.Xz.innerHTML=e+","+t,o.Iq.style.left=5*e+"px",o.Iq.style.top=170-5*t+"px",o.wm.innerHTML=this.cells.get(`${e}_${t}`)?.name||"Failure",this.mapLoaded?(this.noUpdateNeeded=this.updateInternal(e,t),this.noUpdateNeeded):(console.log("NOT READY!"),!0))}updateInternal(e,t){const s=[[e+1,t+1],[e+1,t],[e+1,t-1],[e,t+1],[e,t],[e,t-1],[e-1,t+1],[e-1,t],[e-1,t-1]];for(const e of s){const t=e[0],s=e[1];let i=`${t}_${s}`;if(!this.cells.has(i)){this.cells.set(i,null);let e=c.DEFAULT_CELL_DATA;t>=0&&s>=0&&t<64&&s<35?e=this.mapMatrix[t][s]:console.log(`Out of bounds ${t},${s}`);let a={id:e.id,name:e.name,surface:e.surface};const r=this.cellFactory.createCell(this.scene,t,s,a);return"Somewhere"!=r.name&&"Unknown"!=r.name&&this.boxFactory.cellBoxes(l,r.mesh),this.cells.set(i,r),!1}}for(const s of this.cells.keys()){const[i,a]=s.split(","),r=parseInt(i),n=parseInt(a);if(r<e-1||r>e+1||n<t-1||n>t+1){const e=this.cells.get(s);e&&(this.scene.removeMesh(e.mesh),e.mesh.dispose(),this.cells.delete(s))}}return!0}}},2783:()=>{},6171:()=>{}}]);