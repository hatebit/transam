"use strict";(self.webpackChunktrans_america=self.webpackChunktrans_america||[]).push([[846,938],{7938:(e,t,s)=>{s.r(t),s.d(t,{Boxes:()=>h});var a=s(517),i=s(9529),n=s(2404),o=s(5714),r=s(3077);const l=s.p+"03713868bab7dd2e96995060bf2ae0f5.png";class h{constructor(e){this.scene=e,this.blueMaterial=new a.F("BlueMaterial",e),this.blueMaterial.diffuseColor=new i.v9(.5,.4,.8),this.blueMaterial.emissiveColor=new i.v9(.5,.4,.8),this.concreteMaterial=new a.F("concrete material",e),this.concreteMaterial.diffuseTexture=new r.g(l,e)}baseBoxes(){this.createBox(new i.Pq(4,1,12),new i.Pq(0,0,25),new i.Pq(-Math.PI/8,0,0),0),this.createBox(new i.Pq(4,1,12),new i.Pq(25,0,0),new i.Pq(-Math.PI/8,Math.PI/2,0),0),this.createBox(new i.Pq(4,1,12),new i.Pq(0,0,-25),new i.Pq(Math.PI/8,0,0),0),this.createBox(new i.Pq(4,1,12),new i.Pq(-25,0,0),new i.Pq(Math.PI/8,Math.PI/2,0),0)}randomBoxes(){const e=new i.Pq,t=new i.Pq,s=new i.Pq;for(let a=0;a<20;a++){const a=300*Math.random()-150+5,i=300*Math.random()-150+5,n=10*Math.random();e.set(n,n,n),t.set(i,0,a),s.set(a,a,a),this.createBox(e,t,s,0)}for(let a=0;a<30;a++){const a=300*Math.random()-150+5,i=300*Math.random()-150+5,n=3*Math.random();e.set(n,n,n),t.set(i,0,a),s.set(a,a,a),this.createBox(e,t,s,5)}}createBox(e,t,s,a){const i=n.P.CreateBox("box",{width:e.x,depth:e.z,height:e.y},this.scene);return i.position.set(t.x,t.y,t.z),i.rotation.set(s.x,s.y,s.z),a?(i.position.y+=5,i.material=this.blueMaterial):(a=0,i.material=this.concreteMaterial),i.physicsImpostor=new o.j(i,o.j.BoxImpostor,{mass:a,friction:.5,restitution:.7},this.scene),i}cellBoxes(e,t){const s=e/2,a=new i.Pq,n=new i.Pq,o=new i.Pq;for(let i=0;i<20;i++){const i=Math.random()*e-s,r=Math.random()*e-s,l=10*Math.random();a.set(l,l,l),n.set(r,0,i),o.set(i,i,i),this.createBox(a,n,o,0).parent=t}}createCellBox(e,t,s,a){const i=n.P.CreateBox("box",{width:e.x,depth:e.z,height:e.y});return i.position.set(t.x,t.y,t.z),i.rotation.set(s.x,s.y,s.z),a?(i.position.y+=5,i.material=this.blueMaterial):(a=0,i.material=this.concreteMaterial),i.physicsImpostor=new o.j(i,o.j.BoxImpostor,{mass:a,friction:.5,restitution:.7},this.scene),i}}},3846:(e,t,s)=>{s.r(t),s.d(t,{DEFAULT_CELL_SIZE:()=>w,WorldMap:()=>m});var a=s(2971),i=s(2404),n=s(5714);const o=s.p+"c8f55e9ef9e4d3c0a223a3adaad7ad23.jpg",r=s.p+"c77efafbfaba1476dc4fbf577bd891b4.jpg";var l=s(3077),h=s(517),c=s(7938),d=s(9529),u=s(8070);const w=100,M={name:"Unknown",material:"sand"};class g{constructor(e,t,s,a,o){this.name=a,this.ground=i.P.CreateGround("ground",{width:w,height:w,subdivisions:2},e),this.ground.position.set(t*w,0,s*w),this.ground.physicsImpostor=new n.j(this.ground,n.j.BoxImpostor,{mass:0,friction:.5,restitution:.7},e),this.ground.material=o}}class m{constructor(e){this.cells=new Map,this.lastX=-9999,this.lastZ=-9999,this.noUpdateNeeded=!1,this.scene=e,this.sandMaterial=new h.F("sand material",e);const t=new l.g(o,e);t.vScale=10,t.uScale=10,this.sandMaterial.diffuseTexture=t,this.grassMaterial=new h.F("grass material",e);const s=new l.g(r,e);s.uScale=10,s.vScale=10,this.grassMaterial.diffuseTexture=s,e.fogMode=a.Z.FOGMODE_LINEAR,e.fogStart=20,e.fogEnd=120,e.fogColor=new d.v9(.9,.9,.85),e.fogDensity=.03,e.clearColor=new d.ov(.9,.9,.85,1),this.debugMaterial=new h.F("BlueMaterial",e),this.debugMaterial.diffuseColor=new d.v9(.5,.4,.8),this.debugMaterial.emissiveColor=new d.v9(.5,.4,.8)}update(e,t){return!(this.lastX!==e||this.lastZ!==t||!this.noUpdateNeeded)||(this.lastX=e,this.lastZ=t,console.log(e,t),u.Xz.innerHTML=e+","+t,u.wm.innerHTML=this.cells.get(`${e}_${t}`)?.name||"Failure",this.noUpdateNeeded=this.updateInternal(e,t),this.noUpdateNeeded)}updateInternal(e,t){const s=[[e+1,t+1],[e+1,t],[e+1,t-1],[e,t+1],[e,t],[e,t-1],[e-1,t+1],[e-1,t],[e-1,t-1]];for(const a of s){const s=a[0],i=a[1];let n=`${s}_${i}`;this.cells.has(n)||(this.cells.set(n,null),this.getCellData(s,i).then((a=>{s==e&&i==t&&(u.wm.innerHTML=a.name);const o=this.createCell(this.scene,s,i,a);return this.cells.set(n,o),console.log(`Created cell ${n}`),!1})))}for(const s of this.cells.keys()){const[a,i]=s.split(","),n=parseInt(a),o=parseInt(i);if(n<e-1||n>e+1||o<t-1||o>t+1){const e=this.cells.get(s);e&&(this.scene.removeMesh(e.ground),e.ground.dispose(),this.cells.delete(s))}}return!0}createCell(e,t,s,a){const n=a.name,o="grass"===a.material?this.grassMaterial:this.sandMaterial,r=new g(e,t,s,n,o),l=w/2,h=r.ground,d=i.P.CreateBox("box",{width:1,depth:1,height:4},this.scene);d.material=this.debugMaterial,h.addChild(d);const u=i.P.CreateBox("box",{width:1,depth:1,height:8},this.scene);u.material=this.debugMaterial,u.position.set(t*w+l,4,s*w+l),h.addChild(u);const M=i.P.CreateBox("box",{width:1,depth:1,height:8},this.scene);return M.material=this.debugMaterial,M.position.set(t*w-l,4,s*w-l),h.addChild(M),new c.Boxes(this.scene).cellBoxes(w,h),r}async getCellData(e,t){let s=`world/tiles/${e}_${t}.json`;try{let e=await fetch(s),t=await e.json();return console.log(t),t}catch(e){return console.error("default cell data"),M}}}}}]);
//# sourceMappingURL=846.babylonBundle.js.map