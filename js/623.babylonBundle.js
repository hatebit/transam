(self.webpackChunktrans_america=self.webpackChunktrans_america||[]).push([[623,443,983],{51463:(e,t,s)=>{"use strict";s.r(t),s.d(t,{Boxes:()=>l});var i=s(78065),a=s(89529),n=s(32404),r=s(35714),o=s(23077);const h=s.p+"df2c620b0a3661f6298e59999d511d5f.png",c=s.p+"a4a5639264aaa16fab2af71312fc861a.png";class l{constructor(e){this.scene=e,this.hayMaterial=new i.F("hay material",e),this.hayMaterial.diffuseTexture=new o.g(c,e),this.concreteMaterial=new i.F("concrete material",e),this.concreteMaterial.diffuseTexture=new o.g(h,e)}createBox(e,t,s,i){const a=n.P.CreateBox("box",{width:e.x,depth:e.z,height:e.y},this.scene);return a.position.set(t.x,t.y,t.z),a.rotation.set(s.x,s.y,s.z),i?(a.position.y+=5,a.material=this.hayMaterial,a.physicsImpostor=new r.j(a,r.j.BoxImpostor,{mass:i,friction:100,restitution:.7},this.scene)):(i=0,a.material=this.concreteMaterial,a.physicsImpostor=new r.j(a,r.j.BoxImpostor,{mass:i,friction:.5,restitution:.1},this.scene)),a}cellMovableBoxes(e,t){const s=e/2,i=new a.Pq,n=new a.Pq,r=new a.Pq;for(let a=0;a<20;a++){const a=Math.random()*e-s,o=Math.random()*e-s,h=1.5*Math.random();i.set(h,h,h),n.set(o,-3.5,a),r.set(a,a,a),this.createBox(i,n,r,h).parent=t}}cellBoxes(e,t){const s=e/2,i=new a.Pq,n=new a.Pq,r=new a.Pq;for(let a=0;a<20;a++){const a=Math.random()*e-s,o=Math.random()*e-s,h=10*Math.random();i.set(h,h,h),n.set(o,0,a),r.set(a,a,a),this.createBox(i,n,r,0).parent=t}}}},52026:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GameCamera:()=>n});var i=s(85709),a=s(89529);class n extends i.p{constructor(e,t){super("GameCamera",new a.Pq(0,10,-10),e,t),this.reset(),this.cameraAcceleration=.05,this.maxCameraSpeed=400,this.attachControl(!0)}reset(){this.radius=10,this.heightOffset=4,this.rotationOffset=0}}},73443:(e,t,s)=>{"use strict";s.r(t),s.d(t,{Car:()=>c,ModelCar:()=>l,WheelIndex:()=>i});var i,a=s(65694),n=s(89529),r=s(32404),o=s(55163);!function(e){e[e.FRONT_LEFT=0]="FRONT_LEFT",e[e.FRONT_RIGHT=1]="FRONT_RIGHT",e[e.BACK_LEFT=2]="BACK_LEFT",e[e.BACK_RIGHT=3]="BACK_RIGHT"}(i||(i={}));class h{constructor(e,t,s,i,a){this.position=1,this.halfTrack=1,this.height=.4,this.radius=.4,this.width=.3,this.position=e,this.halfTrack=t,this.height=s,this.radius=i,this.width=a}}class c{constructor(e,t){this.ZERO_QUATERNION=new n.PT,this.chassisWidth=1.8,this.chassisHeight=.6,this.chassisLength=4,this.massVehicle=200,this.backWheelAxisConfig=new h(-.92,.45,.25,.27,.3),this.frontWheelAxisConfig=new h(.6,.45,.18,.27,.3),this.friction=5,this.suspension={stiffness:10,damping:.3,compression:4.4,restLength:.6},this.rollInfluence=0,this.steeringIncrement=.01,this.steeringClamp=.2,this.maxEngineForce=500,this.maxBreakingForce=10,this.incEngine=10,this.vehicleSteering=0,this.engineForce=0,this.breakingForce=0,this.wheelMeshes=[],this.vehicleReady=!1,this.scene=e,this.ammoModule=t,this.greenMaterial=new a.StandardMaterial("GreenMaterial",e),this.greenMaterial.diffuseColor=new n.v9(.1,.8,.5),this.greenMaterial.emissiveColor=new n.v9(.1,.8,.5),this.blackMaterial=new a.StandardMaterial("BlackMaterial",e),this.blackMaterial.diffuseColor=new n.v9(.1,.1,.1),this.blackMaterial.emissiveColor=new n.v9(.1,.1,.1);const s=e.getPhysicsEngine()?.getPhysicsPlugin()?.world;this.wheelDirectionCS0=new t.btVector3(0,-1,0),this.wheelAxleCS=new t.btVector3(-1,0,0),this.chassisMesh=this.createChassisMesh(this.chassisWidth,this.chassisHeight,this.chassisLength);let r=this.chassisMesh.getBoundingInfo().boundingBox.extendSize;const o=new t.btBoxShape(new t.btVector3(r.x,r.y,r.z)),c=new t.btTransform;c.setIdentity(),c.setOrigin(new t.btVector3(0,5,0)),c.setRotation(new t.btQuaternion(this.ZERO_QUATERNION.x,this.ZERO_QUATERNION.y,this.ZERO_QUATERNION.z,this.ZERO_QUATERNION.w));const l=new t.btDefaultMotionState(c),d=new t.btVector3(0,0,0);o.calculateLocalInertia(this.massVehicle,d);const g=new t.btVector3(0,.4,0),u=new t.btTransform;u.setIdentity(),u.setOrigin(g);const f=new t.btCompoundShape;f.addChildShape(u,o);const w=new t.btRigidBody(new t.btRigidBodyConstructionInfo(this.massVehicle,l,f,d));w.setActivationState(4),s.addRigidBody(w),this.tuning=new t.btVehicleTuning;const m=new t.btDefaultVehicleRaycaster(s);this.vehicle=new t.btRaycastVehicle(this.tuning,w,m),this.vehicle.setCoordinateSystem(0,1,2),s.addAction(this.vehicle),this.vehicle.getChassisWorldTransform(),this.addWheelToVehicle(!0,new t.btVector3(this.frontWheelAxisConfig.halfTrack,this.frontWheelAxisConfig.height,this.frontWheelAxisConfig.position),this.frontWheelAxisConfig.radius,this.frontWheelAxisConfig.width,i.FRONT_LEFT),this.addWheelToVehicle(!0,new t.btVector3(-this.frontWheelAxisConfig.halfTrack,this.frontWheelAxisConfig.height,this.frontWheelAxisConfig.position),this.frontWheelAxisConfig.radius,this.frontWheelAxisConfig.width,i.FRONT_RIGHT),this.addWheelToVehicle(!1,new t.btVector3(-this.backWheelAxisConfig.halfTrack,this.backWheelAxisConfig.height,this.backWheelAxisConfig.position),this.backWheelAxisConfig.radius,this.backWheelAxisConfig.width,i.BACK_LEFT),this.addWheelToVehicle(!1,new t.btVector3(this.backWheelAxisConfig.halfTrack,this.backWheelAxisConfig.height,this.backWheelAxisConfig.position),this.backWheelAxisConfig.radius,this.backWheelAxisConfig.width,i.BACK_RIGHT),this.vehicleReady=!0,this.body=w}setPosition(e){const t=new this.ammoModule.btVector3(e.x,e.y,e.z),s=new this.ammoModule.btTransform;s.setOrigin(t),s.setRotation(new this.ammoModule.btQuaternion(this.ZERO_QUATERNION.x,this.ZERO_QUATERNION.y,this.ZERO_QUATERNION.z,this.ZERO_QUATERNION.w)),this.body.setWorldTransform(s)}createChassisMesh(e,t,s){const i=r.P.CreateBox("chassis",{width:e,depth:s,height:t},this.scene);return i.material=this.greenMaterial,i}addWheelToVehicle(e,t,s,i,a){const n=this.vehicle.addWheel(t,this.wheelDirectionCS0,this.wheelAxleCS,this.suspension.restLength,s,this.tuning,e);n.set_m_suspensionStiffness(this.suspension.stiffness),n.set_m_wheelsDampingRelaxation(this.suspension.damping),n.set_m_wheelsDampingCompression(this.suspension.compression),n.set_m_maxSuspensionForce(6e5),n.set_m_frictionSlip(40),n.set_m_rollInfluence(this.rollInfluence),this.wheelMeshes[a]=this.createWheelMesh(s,i,a)}createWheelMesh(e,t,s){const i=r.P.CreateCylinder("Wheel",{diameter:3*e,height:t,tessellation:6},this.scene);return i.rotationQuaternion=new n.PT,i.material=this.greenMaterial,i}}class l extends c{constructor(e,t,s,i){super(e,t),this.scene=e}prepareMesh(e){let t=this.scene.getMeshById(e);return t.rotation=new n.Pq(0,Math.PI,Math.PI),t}createWheelMesh(e,t,s){let a=super.createWheelMesh(e,t,s);switch(s){case i.FRONT_LEFT:let e=this.scene.getMeshById("wheel-front-left");e.rotation=new n.Pq(0,0,Math.PI/2),e.position.set(0,0,0),a.addChild(e);break;case i.FRONT_RIGHT:let t=this.scene.getMeshById("wheel-front-right");t.rotation=new n.Pq(0,0,Math.PI/2),t.position.set(0,0,0),a.addChild(t);break;case i.BACK_LEFT:let s=this.scene.getMeshById("wheel-back-left");s.rotation=new n.Pq(0,0,-Math.PI/2),s.position.set(0,0,0),a.addChild(s);break;case i.BACK_RIGHT:let r=this.scene.getMeshById("wheel-back-right");r.rotation=new n.Pq(0,0,-Math.PI/2),r.position.set(0,0,0),a.addChild(r)}return a.visibility=o.CONFIGURATION.debug?.5:0,a}createChassisMesh(e,t,s){console.log("createChassisMesh");let i=this.prepareMesh("body"),a=i.getBoundingInfo().boundingBox.extendSize,n=super.createChassisMesh(2*a.x,2*a.y,2*a.z);return n.addChild(i),n.visibility=o.CONFIGURATION.debug?.2:0,n}}},28778:(e,t,s)=>{"use strict";s.r(t),s.d(t,{Cell:()=>w,CellFactory:()=>m,DEFAULT_CELL_DATA:()=>u});var i=s(78065),a=s(32404),n=s(35714),r=s(52629),o=s(23077);const h=s.p+"35d21f322262d71ee0b98902e5539e7c.png",c=s.p+"e2b9aafce35db35ad11bd4f60bcd4787.png",l=s.p+"c70bded218d79ce0fdbf98e1637b23b4.png",d=s.p+"7e4d011524bce60b6a68d0c4f28f2d36.png";var g=s(89529);const u={id:"._.",name:"Unknown",surface:"unknown"};var f;!function(e){e.GRASS="grass",e.WALL="wall",e.OCEAN="ocean",e.SAND="sand",e.SNOW="snow",e.WATER="water"}(f||(f={}));class w{constructor(e,t){this.name=e,this.mesh=t}}class m{constructor(e){this.scene=e,this.sandMaterial=new i.F("sand material",e);const t=new o.g(h,e);t.vScale=10,t.uScale=10,this.sandMaterial.diffuseTexture=t,this.sandMaterial.freeze(),this.grassMaterial=new i.F("grass material",e);const s=new o.g(c,e);s.uScale=5,s.vScale=5,this.grassMaterial.diffuseTexture=s,this.grassMaterial.freeze(),this.oceanMaterial=new i.F("ocean material",e);const a=new o.g(l,e);a.uScale=10,a.vScale=10,this.oceanMaterial.diffuseTexture=a,this.oceanMaterial.freeze(),this.wallMaterial=new i.F("wall material",e);const n=new o.g(d,e);n.uScale=10,n.vScale=10,this.wallMaterial.diffuseTexture=n,this.wallMaterial.freeze(),this.debugMaterial=new i.F("BlueMaterial",e),this.debugMaterial.diffuseColor=new g.v9(.5,.4,.8),this.debugMaterial.emissiveColor=new g.v9(.5,.4,.8),this.debugMaterial.freeze(),this.snowMaterial=new i.F("snow material",e),this.snowMaterial.diffuseColor=new g.v9(1,1,1),this.snowMaterial.emissiveColor=new g.v9(1,1,1),this.snowMaterial.freeze()}createCell(e,t,s,i){switch(i.surface){case f.SAND:return new p(e,t,s,i.name,this.sandMaterial);case f.GRASS:return new p(e,t,s,i.name,this.grassMaterial);case f.WALL:return new b(e,t,s,i.name,this.wallMaterial);case f.OCEAN:case f.WATER:return new p(e,t,s,i.name,this.oceanMaterial);case f.SNOW:return new p(e,t,s,i.name,this.snowMaterial);default:return new b(e,t,s,i.name,this.debugMaterial)}}}class p extends w{constructor(e,t,s,i,o){super(i,a.P.CreateGround("flat",{width:r.DEFAULT_CELL_SIZE,height:r.DEFAULT_CELL_SIZE,subdivisions:2})),this.mesh.position.set(t*r.DEFAULT_CELL_SIZE,0,s*r.DEFAULT_CELL_SIZE),this.mesh.physicsImpostor=new n.j(this.mesh,n.j.BoxImpostor,{mass:0,friction:.5,restitution:.7}),this.mesh.material=o,e.addChild(this.mesh)}}class b extends w{constructor(e,t,s,i,o){super(i,a.P.CreateBox("cube",{size:r.DEFAULT_CELL_SIZE})),this.mesh.position.set(t*r.DEFAULT_CELL_SIZE,0,s*r.DEFAULT_CELL_SIZE),this.mesh.physicsImpostor=new n.j(this.mesh,n.j.BoxImpostor,{mass:0,friction:.5,restitution:.7}),this.mesh.material=o,e.addChild(this.mesh)}}},16983:(e,t,s)=>{"use strict";s.r(t),s.d(t,{CarControls:()=>d,GlobalControls:()=>l});var i=s(89529),a=s(73443),n=s(75058),r=s(65694),o=s(98070);const h=new Map([["acceleration",!1],["braking",!1],["right",!1],["left",!1],["reset",!1],["flip",!1],["stop",!1]]),c=new Map([["KeyW","acceleration"],["KeyS","braking"],["KeyA","left"],["KeyD","right"],["KeyR","reset"],["KeyF","flip"],["Space","stop"]]);class l{constructor(e){window.addEventListener("keypress",(t=>{if("KeyI"===t.code&&(n.Inspector.IsVisible?n.Inspector.Hide():n.Inspector.Show(e,{})),"KeyO"===t.code){let t=new r.SceneOptimizerOptions,s=new r.SceneOptimizer(e,t);s.onNewOptimizationAppliedObservable.add((e=>{o.N.message("New optimization"+e.getDescription())})),s.onFailureObservable.add(((e,t)=>{o.N.message("FAILED to optimize scene")})),s.onSuccessObservable.add(((e,t)=>{o.N.message("SUCCESS to optimize scene")})),s.start()}}))}}class d{constructor(e,t,s){this.car=e,this.camera=t,this.resetPosition=s,window.addEventListener("keydown",this.keydown),window.addEventListener("keyup",this.keyup)}update(){if(this.car.vehicleReady){const e=this.car.vehicle.getCurrentSpeedKmHour();if(this.car.breakingForce=0,this.car.engineForce=0,h.get("reset")&&(this.car.setPosition(this.resetPosition),console.log("reset "+this.car.chassisMesh.position),this.camera.reset(),this.camera.lockedTarget=this.car.chassisMesh),h.get("flip")){let e=this.car.chassisMesh.position;this.car.setPosition(new i.Pq(e.x,this.resetPosition.y,e.z))}let t,s,n,r;h.get("acceleration")?e<-1?this.car.breakingForce=this.car.maxBreakingForce:this.car.engineForce=this.car.maxEngineForce:h.get("braking")?e>1?this.car.breakingForce=this.car.maxBreakingForce:this.car.engineForce=-this.car.maxEngineForce:h.get("stop")&&(e>1?this.car.breakingForce=2*this.car.maxBreakingForce:e<-1&&(this.car.engineForce=2*this.car.maxEngineForce)),h.get("right")?this.car.vehicleSteering<this.car.steeringClamp&&(this.car.vehicleSteering+=this.car.steeringIncrement):h.get("left")?this.car.vehicleSteering>-this.car.steeringClamp&&(this.car.vehicleSteering-=this.car.steeringIncrement):this.car.vehicleSteering=0,this.car.vehicle.applyEngineForce(this.car.engineForce,a.WheelIndex.FRONT_LEFT),this.car.vehicle.applyEngineForce(this.car.engineForce,a.WheelIndex.FRONT_RIGHT),this.car.vehicle.setBrake(this.car.breakingForce/2,a.WheelIndex.FRONT_LEFT),this.car.vehicle.setBrake(this.car.breakingForce/2,a.WheelIndex.FRONT_RIGHT),this.car.vehicle.setBrake(this.car.breakingForce,a.WheelIndex.BACK_LEFT),this.car.vehicle.setBrake(this.car.breakingForce,a.WheelIndex.BACK_RIGHT),this.car.vehicle.setSteeringValue(this.car.vehicleSteering,a.WheelIndex.FRONT_LEFT),this.car.vehicle.setSteeringValue(this.car.vehicleSteering,a.WheelIndex.FRONT_RIGHT);const o=this.car.vehicle.getNumWheels();for(r=0;r<o;r++){this.car.vehicle.updateWheelTransform(r,!0),t=this.car.vehicle.getWheelTransformWS(r),s=t.getOrigin(),n=t.getRotation();const e=this.car.wheelMeshes[r];e.position.set(s.x(),s.y(),s.z()),e.rotationQuaternion?.set(n.x(),n.y(),n.z(),n.w()),e.rotate(i._0.Z,Math.PI/2)}t=this.car.vehicle.getChassisWorldTransform(),s=t.getOrigin(),n=t.getRotation(),this.car.chassisMesh.position.set(s.x(),s.y(),s.z()),this.car.chassisMesh.rotationQuaternion?.set(n.x(),n.y(),n.z(),n.w()),this.car.chassisMesh.rotate(i._0.X,Math.PI)}}keyup(e){c.get(e.code)&&h.set(c.get(e.code)??"",!1)}keydown(e){c.get(e.code)&&h.set(c.get(e.code)??"",!0)}}},29207:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>C});var i=s(86521),a=s(54983),n=s(57069),r=s(85847),o=(s(51446),s(78065),s(19846));let h;const c=new Promise((e=>{(new o).then((t=>{h=t,e(t)}))})),l=s.p+"76cf32522d595b7a90ca87d4aa09700b.glb",d=s.p+"6ca05682d62c724825ed74b2d97e9bec.glb",g=s.p+"28771b48b17c5881dd079cb32aecbea2.glb";var u=s(73443),f=s(16983),w=s(52629),m=s(98070),p=s(52026),b=s(23935);const C=new class{constructor(){this.preTasks=[c],this.createScene=async(e,t)=>{const s=new i.Z(e,{useGeometryUniqueIdsMap:!0});s.autoClearDepthAndStencil=!1,new n.g("light",new a.Pq(0,1,0),s).intensity=.7,s.enablePhysics(new a.Pq(0,-10,0),new r.v(!0,h)),await b.cng.ImportMeshAsync("",d,"",s,(function(e){s.getMeshById("wheel-default")})),await b.cng.ImportMeshAsync("",l,"",s,(function(e){s.getMeshById("cone")})),await b.cng.ImportMeshAsync("",g,"",s,(function(e){s.getMeshById("body")?console.log("body loaded"):console.log("body not loaded")})),await new Promise((e=>setTimeout(e,1500))),console.log("scene loaded");let o=new a.Pq(4*w.DEFAULT_CELL_SIZE,20,26*w.DEFAULT_CELL_SIZE);const c=new u.ModelCar(s,h,"body","wheel");c.setPosition(o);const C=new p.GameCamera(s,c.chassisMesh),M=new w.WorldMap(s),T=new f.CarControls(c,C,o);return new f.GlobalControls(s),s.activeCamera=C,s.registerBeforeRender((function(){e.getDeltaTime(),T.update();const t=c.chassisMesh.position,s=0|Math.round(t.x/w.DEFAULT_CELL_SIZE),i=0|Math.round(t.z/w.DEFAULT_CELL_SIZE);M.update(s,i),m.N.fps(e.getFps()),m.N.speed(c.vehicle.getCurrentSpeedKmHour())})),s}}}},52629:(e,t,s)=>{"use strict";s.r(t),s.d(t,{DEFAULT_CELL_SIZE:()=>l,WorldMap:()=>d});var i=s(86521),a=s(65694);const n=s.p+"51a9ce4c9839dfc9f58a2fb7ed4db5ee.txt";var r=s(51463),o=s(89529),h=s(98070),c=s(28778);const l=100;class d{constructor(e){this.cells=new Map,this.lastX=-9999,this.lastZ=-9999,this.noUpdateNeeded=!1,this.mapData={},this.mapMatrix=function(e,t,s=0){return Array.from({length:e},(()=>Array.from({length:t},(()=>s))))}(64,35,c.DEFAULT_CELL_DATA),this.mapLoaded=!1,this.scene=e,this.cellFactory=new c.CellFactory(e),this.boxFactory=new r.Boxes(e),this.groundNode=new a.TransformNode("ground",e);let t=this,s=new a.AssetsManager(e),h=s.addTextFileTask("task",n);s.onTaskError=function(e){alert("error while loading "+e.name)},h.onError=function(e,t,s){alert(t),alert(s)},h.onSuccess=function(e){t.mapData=JSON.parse(e.text);for(let e of t.mapData.cells)try{let s=e.col,i=e.row;t.mapMatrix[s][i]={id:s+"_"+i,name:e.name,surface:e.surface}}catch(t){console.error("Error parsing cell",e)}},s.onFinish=function(e){console.log("done loading"),t.mapLoaded=!0},s.load(),e.fogMode=i.Z.FOGMODE_LINEAR,e.fogStart=20,e.fogEnd=120,e.fogColor=new o.v9(.9,.9,.85),e.fogDensity=.03,e.clearColor=new o.ov(.9,.9,.85,1)}update(e,t){return!(this.lastX!==e||this.lastZ!==t||!this.noUpdateNeeded)||(this.lastX=e,this.lastZ=t,h.N.mapPosition(e,t),h.N.district(this.cells.get(`${e}_${t}`)?.name||"Failure"),this.mapLoaded?(this.noUpdateNeeded=this.updateInternal(e,t),this.noUpdateNeeded):(console.log("NOT READY!"),!0))}updateInternal(e,t){const s=[[e+1,t+1],[e+1,t],[e+1,t-1],[e,t+1],[e,t],[e,t-1],[e-1,t+1],[e-1,t],[e-1,t-1]];for(const e of s){const t=e[0],s=e[1];let i=`${t}_${s}`;if(!this.cells.has(i)){h.N.message(`Creating cell ${i}`),this.cells.set(i,null);let e=c.DEFAULT_CELL_DATA;t>=0&&s>=0&&t<64&&s<35?e=this.mapMatrix[t][s]:console.log(`Out of bounds ${t},${s}`);let a={id:e.id,name:e.name,surface:e.surface};const n=this.cellFactory.createCell(this.groundNode,t,s,a);return"Somewhere"!=n.name&&"Unknown"!=n.name?this.boxFactory.cellBoxes(l,n.mesh):this.boxFactory.cellMovableBoxes(l,n.mesh),this.cells.set(i,n),!1}}this.scene.blockfreeActiveMeshesAndRenderingGroups=!0;for(const s of this.cells.keys()){const[i,a]=s.split(","),n=parseInt(i),r=parseInt(a);if(n<e-1||n>e+1||r<t-1||r>t+1){const e=this.cells.get(s);e&&(this.groundNode.removeChild(e.mesh),e.mesh.dispose(),this.cells.delete(s))}}return this.scene.blockfreeActiveMeshesAndRenderingGroups=!1,h.N.message(`${this.cells.size} cells in cache`),!0}}},92783:()=>{},66171:()=>{}}]);