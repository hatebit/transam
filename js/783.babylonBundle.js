"use strict";(self.webpackChunktrans_america=self.webpackChunktrans_america||[]).push([[783],{9783:(e,t,a)=>{a.d(t,{d:()=>c});var i=a(54983),n=a(49111),o=a(47369),r=a(50507),s=a(39341);class l{constructor(e,t,a,i){this.name=e,this.worldAxisForNormal=t,this.worldAxisForFileX=a,this.worldAxisForFileY=i}}class c{static ConvertCubeMapTextureToSphericalPolynomial(e){if(!e.isCube)return null;e.getScene()?.getEngine().flushFramebuffer();const t=e.getSize().width,a=e.readPixels(0,void 0,void 0,!1),i=e.readPixels(1,void 0,void 0,!1);let n,o;e.isRenderTarget?(n=e.readPixels(3,void 0,void 0,!1),o=e.readPixels(2,void 0,void 0,!1)):(n=e.readPixels(2,void 0,void 0,!1),o=e.readPixels(3,void 0,void 0,!1));const r=e.readPixels(4,void 0,void 0,!1),s=e.readPixels(5,void 0,void 0,!1),l=e.gammaSpace;let c=0;return 1!=e.textureType&&2!=e.textureType||(c=1),new Promise((e=>{Promise.all([i,a,n,o,r,s]).then((([a,i,n,o,r,s])=>{const d={size:t,right:i,left:a,up:n,down:o,front:r,back:s,format:5,type:c,gammaSpace:l};e(this.ConvertCubeMapToSphericalPolynomial(d))}))}))}static _AreaElement(e,t){return Math.atan2(e*t,Math.sqrt(e*e+t*t+1))}static ConvertCubeMapToSphericalPolynomial(e){const t=new o.O;let a=0;const i=2/e.size,l=i,c=.5*i,d=c-1;for(let o=0;o<6;o++){const w=this._FileFaces[o],P=e[w.name];let m=d;const h=5===e.format?4:3;for(let o=0;o<e.size;o++){let p=d;for(let l=0;l<e.size;l++){const d=w.worldAxisForFileX.scale(p).add(w.worldAxisForFileY.scale(m)).add(w.worldAxisForNormal);d.normalize();const v=this._AreaElement(p-c,m-c)-this._AreaElement(p-c,m+c)-this._AreaElement(p+c,m-c)+this._AreaElement(p+c,m+c);let u=P[o*e.size*h+l*h+0],q=P[o*e.size*h+l*h+1],C=P[o*e.size*h+l*h+2];isNaN(u)&&(u=0),isNaN(q)&&(q=0),isNaN(C)&&(C=0),0===e.type&&(u/=255,q/=255,C/=255),e.gammaSpace&&(u=Math.pow((0,n.Clamp)(u),r.tk),q=Math.pow((0,n.Clamp)(q),r.tk),C=Math.pow((0,n.Clamp)(C),r.tk));const x=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const e=Math.max(u,q,C);if(e>x){const t=x/e;u*=t,q*=t,C*=t}}else u=(0,n.Clamp)(u,0,x),q=(0,n.Clamp)(q,0,x),C=(0,n.Clamp)(C,0,x);const f=new s.v9(u,q,C);t.addLight(d,f,v),a+=v,p+=i}m+=l}}const w=4*Math.PI*6/6/a;return t.scaleInPlace(w),t.convertIncidentRadianceToIrradiance(),t.convertIrradianceToLambertianRadiance(),o.Q.FromHarmonics(t)}}c._FileFaces=[new l("right",new i.Pq(1,0,0),new i.Pq(0,0,-1),new i.Pq(0,-1,0)),new l("left",new i.Pq(-1,0,0),new i.Pq(0,0,1),new i.Pq(0,-1,0)),new l("up",new i.Pq(0,1,0),new i.Pq(1,0,0),new i.Pq(0,0,1)),new l("down",new i.Pq(0,-1,0),new i.Pq(1,0,0),new i.Pq(0,0,-1)),new l("front",new i.Pq(0,0,1),new i.Pq(1,0,0),new i.Pq(0,-1,0)),new l("back",new i.Pq(0,0,-1),new i.Pq(-1,0,0),new i.Pq(0,-1,0))],c.MAX_HDRI_VALUE=4096,c.PRESERVE_CLAMPED_COLORS=!1}}]);