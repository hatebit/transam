"use strict";(self.webpackChunktrans_america=self.webpackChunktrans_america||[]).push([[6,463],{51463:(e,t,s)=>{s.r(t),s.d(t,{Boxes:()=>h});var a=s(78065),r=s(89529),n=s(32404),i=s(35714),o=s(23077);const l=s.p+"df2c620b0a3661f6298e59999d511d5f.png",c=s.p+"a4a5639264aaa16fab2af71312fc861a.png";class h{constructor(e){this.scene=e,this.hayMaterial=new a.F("hay material",e),this.hayMaterial.diffuseTexture=new o.g(c,e),this.concreteMaterial=new a.F("concrete material",e),this.concreteMaterial.diffuseTexture=new o.g(l,e)}createBox(e,t,s,a){const r=n.P.CreateBox("box",{width:e.x,depth:e.z,height:e.y},this.scene);return r.position.set(t.x,t.y,t.z),r.rotation.set(s.x,s.y,s.z),a?(r.position.y+=5,r.material=this.hayMaterial,r.physicsImpostor=new i.j(r,i.j.BoxImpostor,{mass:a,friction:100,restitution:.7},this.scene)):(a=0,r.material=this.concreteMaterial,r.physicsImpostor=new i.j(r,i.j.BoxImpostor,{mass:a,friction:.5,restitution:.1},this.scene)),r}cellMovableBoxes(e,t){const s=e/2,a=new r.Pq,n=new r.Pq,i=new r.Pq;for(let r=0;r<20;r++){const r=Math.random()*e-s,o=Math.random()*e-s,l=1.5*Math.random();a.set(l,l,l),n.set(o,-3.5,r),i.set(r,r,r),this.createBox(a,n,i,l).parent=t}}cellBoxes(e,t){const s=e/2,a=new r.Pq,n=new r.Pq,i=new r.Pq;for(let r=0;r<20;r++){const r=Math.random()*e-s,o=Math.random()*e-s,l=10*Math.random();a.set(l,l,l),n.set(o,0,r),i.set(r,r,r),this.createBox(a,n,i,0).parent=t}}}},28778:(e,t,s)=>{s.r(t),s.d(t,{Cell:()=>w,CellFactory:()=>p,DEFAULT_CELL_DATA:()=>m});var a=s(78065),r=s(32404),n=s(35714),i=s(52629),o=s(23077);const l=s.p+"35d21f322262d71ee0b98902e5539e7c.png",c=s.p+"e2b9aafce35db35ad11bd4f60bcd4787.png",h=s.p+"c70bded218d79ce0fdbf98e1637b23b4.png",d=s.p+"7e4d011524bce60b6a68d0c4f28f2d36.png";var u=s(89529);const m={id:"._.",name:"Unknown",surface:"unknown"};var f;!function(e){e.GRASS="grass",e.WALL="wall",e.OCEAN="ocean",e.SAND="sand",e.SNOW="snow",e.WATER="water"}(f||(f={}));class w{constructor(e,t){this.name=e,this.mesh=t}}class p{constructor(e){this.scene=e,this.sandMaterial=new a.F("sand material",e);const t=new o.g(l,e);t.vScale=10,t.uScale=10,this.sandMaterial.diffuseTexture=t,this.sandMaterial.freeze(),this.grassMaterial=new a.F("grass material",e);const s=new o.g(c,e);s.uScale=5,s.vScale=5,this.grassMaterial.diffuseTexture=s,this.grassMaterial.freeze(),this.oceanMaterial=new a.F("ocean material",e);const r=new o.g(h,e);r.uScale=10,r.vScale=10,this.oceanMaterial.diffuseTexture=r,this.oceanMaterial.freeze(),this.wallMaterial=new a.F("wall material",e);const n=new o.g(d,e);n.uScale=10,n.vScale=10,this.wallMaterial.diffuseTexture=n,this.wallMaterial.freeze(),this.debugMaterial=new a.F("BlueMaterial",e),this.debugMaterial.diffuseColor=new u.v9(.5,.4,.8),this.debugMaterial.emissiveColor=new u.v9(.5,.4,.8),this.debugMaterial.freeze(),this.snowMaterial=new a.F("snow material",e),this.snowMaterial.diffuseColor=new u.v9(1,1,1),this.snowMaterial.emissiveColor=new u.v9(1,1,1),this.snowMaterial.freeze()}createCell(e,t,s,a){switch(a.surface){case f.SAND:return new M(e,t,s,a.name,this.sandMaterial);case f.GRASS:return new M(e,t,s,a.name,this.grassMaterial);case f.WALL:return new g(e,t,s,a.name,this.wallMaterial);case f.OCEAN:case f.WATER:return new M(e,t,s,a.name,this.oceanMaterial);case f.SNOW:return new M(e,t,s,a.name,this.snowMaterial);default:return new g(e,t,s,a.name,this.debugMaterial)}}}class M extends w{constructor(e,t,s,a,o){super(a,r.P.CreateGround("flat",{width:i.DEFAULT_CELL_SIZE,height:i.DEFAULT_CELL_SIZE,subdivisions:2})),this.mesh.position.set(t*i.DEFAULT_CELL_SIZE,0,s*i.DEFAULT_CELL_SIZE),this.mesh.physicsImpostor=new n.j(this.mesh,n.j.BoxImpostor,{mass:0,friction:.5,restitution:.7}),this.mesh.material=o,e.addChild(this.mesh)}}class g extends w{constructor(e,t,s,a,o){super(a,r.P.CreateBox("cube",{size:i.DEFAULT_CELL_SIZE})),this.mesh.position.set(t*i.DEFAULT_CELL_SIZE,0,s*i.DEFAULT_CELL_SIZE),this.mesh.physicsImpostor=new n.j(this.mesh,n.j.BoxImpostor,{mass:0,friction:.5,restitution:.7}),this.mesh.material=o,e.addChild(this.mesh)}}},52629:(e,t,s)=>{s.r(t),s.d(t,{DEFAULT_CELL_SIZE:()=>h,WorldMap:()=>d});var a=s(86521),r=s(65694);const n=s.p+"51a9ce4c9839dfc9f58a2fb7ed4db5ee.txt";var i=s(51463),o=s(89529),l=s(98070),c=s(28778);const h=100;class d{constructor(e){this.cells=new Map,this.lastX=-9999,this.lastZ=-9999,this.noUpdateNeeded=!1,this.mapData={},this.mapMatrix=function(e,t,s=0){return Array.from({length:e},(()=>Array.from({length:t},(()=>s))))}(64,35,c.DEFAULT_CELL_DATA),this.mapLoaded=!1,this.scene=e,this.cellFactory=new c.CellFactory(e),this.boxFactory=new i.Boxes(e),this.groundNode=new r.TransformNode("ground",e);let t=this,s=new r.AssetsManager(e),l=s.addTextFileTask("task",n);s.onTaskError=function(e){alert("error while loading "+e.name)},l.onError=function(e,t,s){alert(t),alert(s)},l.onSuccess=function(e){t.mapData=JSON.parse(e.text);for(let e of t.mapData.cells)try{let s=e.col,a=e.row;t.mapMatrix[s][a]={id:s+"_"+a,name:e.name,surface:e.surface}}catch(t){console.error("Error parsing cell",e)}},s.onFinish=function(e){console.log("done loading"),t.mapLoaded=!0},s.load(),e.fogMode=a.Z.FOGMODE_LINEAR,e.fogStart=20,e.fogEnd=120,e.fogColor=new o.v9(.9,.9,.85),e.fogDensity=.03,e.clearColor=new o.ov(.9,.9,.85,1)}update(e,t){return!(this.lastX!==e||this.lastZ!==t||!this.noUpdateNeeded)||(this.lastX=e,this.lastZ=t,l.N.mapPosition(e,t),l.N.district(this.cells.get(`${e}_${t}`)?.name||"Failure"),this.mapLoaded?(this.noUpdateNeeded=this.updateInternal(e,t),this.noUpdateNeeded):(console.log("NOT READY!"),!0))}updateInternal(e,t){const s=[[e+1,t+1],[e+1,t],[e+1,t-1],[e,t+1],[e,t],[e,t-1],[e-1,t+1],[e-1,t],[e-1,t-1]];for(const e of s){const t=e[0],s=e[1];let a=`${t}_${s}`;if(!this.cells.has(a)){l.N.message(`Creating cell ${a}`),this.cells.set(a,null);let e=c.DEFAULT_CELL_DATA;t>=0&&s>=0&&t<64&&s<35?e=this.mapMatrix[t][s]:console.log(`Out of bounds ${t},${s}`);let r={id:e.id,name:e.name,surface:e.surface};const n=this.cellFactory.createCell(this.groundNode,t,s,r);return"Somewhere"!=n.name&&"Unknown"!=n.name?this.boxFactory.cellBoxes(h,n.mesh):this.boxFactory.cellMovableBoxes(h,n.mesh),this.cells.set(a,n),!1}}this.scene.blockfreeActiveMeshesAndRenderingGroups=!0;for(const s of this.cells.keys()){const[a,r]=s.split(","),n=parseInt(a),i=parseInt(r);if(n<e-1||n>e+1||i<t-1||i>t+1){const e=this.cells.get(s);e&&(this.groundNode.removeChild(e.mesh),e.mesh.dispose(),this.cells.delete(s))}}return this.scene.blockfreeActiveMeshesAndRenderingGroups=!1,l.N.message(`${this.cells.size} cells in cache`),!0}}},35714:(e,t,s)=>{s.d(t,{j:()=>a.j});var a=s(29206)}}]);